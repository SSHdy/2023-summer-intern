webpackJsonp([20],{"7/hw":function(t,e,o){"use strict";e.i=function(){return new i.a(function(t,e){n.a.post(r.f+"/yard/yardUnitReport",null).then(function(e){t(e)},function(t){e(t)})})},e.e=function(){return new i.a(function(t,e){n.a.post(r.f+"/reportUnit/businessHouse",null).then(function(e){t(e)},function(t){e(t)})})},e.f=function(){return new i.a(function(t,e){n.a.post(r.f+"/reportUnit/constructHouseList",null).then(function(e){t(e)},function(t){e(t)})})},e.h=function(t,e,o,a,s){return new i.a(function(i,l){n.a.post(r.f+"/reportUnit/reportUnitList",{currentPage:t,pageSize:e,reportYear:o,unitName:a,state:s}).then(function(t){i(t)},function(t){l(t)})})},e.j=function(t){return new i.a(function(e,o){n.a.post(r.f+"/reportUnit/reportUnit",t).then(function(t){e(t)},function(t){o(t)})})},e.g=function(){return new i.a(function(t,e){n.a.post(r.f+"/downloadTemplate/downloadTemplateList").then(function(e){t(e)},function(t){e(t)})})},e.k=function(){return new i.a(function(t,e){n.a.post(r.f+"/distInformation/selectDistInfo").then(function(e){t(e)},function(t){e(t)})})},e.b=function(t){return new i.a(function(e,o){Object(n.a)({method:"post",url:r.f+"/reportUnit/exportDataExcel",responseType:"arraybuffer",data:t}).then(function(t){e(t)},function(t){o(t)})})},e.d=function(){return new i.a(function(t,e){n.a.post(r.f+"/reportUnit/unitList",{}).then(function(e){t(e)},function(t){e(t)})})},e.a=function(t){return new i.a(function(e,o){Object(n.a)({method:"post",url:r.f+"/reportUnit/downLoad",responseType:"arraybuffer",data:{addressList:t}}).then(function(t){e(t)},function(t){o(t)})})},e.c=function(t){return new i.a(function(e,o){n.a.post(r.f+"/reportUnit/allReportEnclosure",{reportYear:t}).then(function(t){e(t)},function(t){o(t)})})};var a=o("//Fk"),i=o.n(a),n=o("eOoE"),r=o("u3Mf")},Pf99:function(t,e){},R4mH:function(t,e,o){"use strict";(function(t){var a=o("BO1k"),i=o.n(a),n=o("fZjL"),r=o.n(n),s=o("7/hw"),l=(o("yzMb"),o("u3Mf")),c=o("uSev"),u=o("GR1E"),p=o("fYBn"),d=o("02tb"),f=o("5kkW"),h=o("3a1n"),g=o("QB36"),m=o("aEtF");e.a={components:{tablePagination:u.a,tableComponent:c.a,cancelBtn:p.a,confirmBtn:d.a,searchBtn:f.a,resetBtn:h.a,downloadBtn:g.a,uploadBtn:m.a},data:function(){return{reportYear:"",unitName:"",state:"",currentPage:1,pageSize:15,total:0,loading:null,tableHeight:0,selectData:[],tableData:[],dialogTitle:"",operateType:"add",templateDialogVisible:!1,uploadDialogVisible:!1,stateOpts:[{id:"",name:"全部"},{id:1,name:"已上报"},{id:0,name:"未上报"}],templateCheckList:"",templateList:[],uploadUrl:""+l.a+l.f+"/uploads/unitFile?uploadType=reportUnit",acceptType:".xlsx,.xls",limit:1,fileList:[],uploadNum:0,uploadSuccessNum:0,submitFlag:!1,token:"",postHeaders:{Authorization:""},reportUploadForm:{reportId:"",reportEnclosureName:"",reportEnclosurePhysicsUrl:"",reportEnclosureVirtualUrl:"",haveFile:""},isReported:!1,reportUnitOpts:[],reportUploadRules:{reportId:[{required:!0,message:"请选择上报单位",trigger:"change"}],haveFile:[{required:!0,message:"请先上传文件",trigger:"blur"}]},addressList:[],downloadDialogVisible:!1,reportDownloadForm:{reportYear:""},reportDownloadRules:{reportYear:[{required:!0,message:"请先选择年份",trigger:"blur"}]}}},created:function(){this.reportYear=this.formatDate((new Date).getTime(),"yyyy")},mounted:function(){var e=this;this.getList(),this.getDownloadTemplateList(),this.token=sessionStorage.getItem("TOKEN"),this.token&&(this.postHeaders.Authorization="Bearer "+this.token),setTimeout(function(){var o=t("#mainDiv").height(),a=t("#queryBox").outerHeight(!0),i=t("#operateBox").height();e.tableHeight=o-a-i},1)},methods:{loadingStart:function(t){this.loading||(this.loading=this.$loading({lock:!0,text:"正在加载...",spinner:"el-icon-loading",target:t,customClass:"loading-box"}))},loadingEnd:function(){this.loading&&(this.loading.close(),this.loading=null)},changeSize:function(t){this.pageSize=t,this.getList()},changePage:function(t){this.currentPage=t,this.getList()},getList:function(){var t=this;this.loadingStart(".table-box"),Object(s.h)(this.currentPage,this.pageSize,this.reportYear,this.unitName,this.state).then(function(e){t.tableData=e.records,t.total=e.total,t.loadingEnd()}).catch(function(e){t.loadingEnd();var o=e.result?e.result:"单位上报列表获取失败";t.$message({message:o,type:"error"})})},search:function(){this.currentPage=1,this.getList()},reset:function(){this.currentPage=1,this.reportYear=this.formatDate((new Date).getTime(),"yyyy"),this.unitName="",this.state="",this.search()},handleSelectionChange:function(t){this.selectData=t},getDownloadTemplateList:function(){var t=this;Object(s.g)().then(function(e){t.templateList=e}).catch(function(e){var o=e.result?e.result:"模板链接获取失败";t.$message({message:o,type:"error"})})},templateDialogOpen:function(){this.dialogTitle="模板下载",this.templateDialogVisible=!0},templateDownLoad:function(){if(this.templateCheckList){console.log(l.a);var t=""+l.a+l.f+this.templateCheckList;window.open(t,"_self"),this.$message({message:"下载成功！",type:"success"}),this.templateDialogVisible=!1}else this.$message({message:"请先选择一个模板！",type:"warning"})},uploadOpen:function(){this.dialogTitle="上传",this.uploadDialogVisible=!0,this.getAllReportUnitList()},getAllReportUnitList:function(){var t=this;Object(s.d)().then(function(e){t.reportUnitOpts=e}).catch(function(e){var o=e.result?e.result:"上报单位获取失败";t.$message({message:o,type:"error"})})},saveUploadData:function(){var t=this;delete this.reportUploadForm.haveFile,Object(s.j)(this.reportUploadForm).then(function(e){t.$message({message:"上传成功",type:"success"}),t.uploadDialogVisible=!1,t.getList()}).catch(function(e){var o=e.result?e.result:"上传失败";t.$message({message:o,type:"error"})})},submitUploadData:function(){var t=this;this.$refs.reportUploadForm.validate(function(e){if(!e)return!1;for(var o=0;o<t.reportUnitOpts.length;o++)if(t.reportUnitOpts[o].reportId===t.reportUploadForm.reportId)return 1===t.reportUnitOpts[o].isReport?t.$confirm("该单位已有上报文件, 继续上传将覆盖已有文件，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$refs.upload.submit()}).catch(function(){t.$message({type:"info",message:"已取消上传"})}):t.$refs.upload.submit(),!1})},beforeAvatarUpload:function(t){if(!(t.size/1024/1024<200))return this.$message.error("上传文件大小不能超过200MB!"),!1},handleRemove:function(t,e){this.uploadNum=e.length,this.fileList=e,this.reportUploadForm.haveFile=""},handleChange:function(t,e){this.uploadNum=e.length,this.fileList=e,1===e.length?this.reportUploadForm.haveFile=t.name:this.reportUploadForm.haveFile=""},handleExceed:function(t,e){this.$message.warning("最多只能上传一个文件！")},handleError:function(t,e,o){401===t.status&&(this.$store.dispatch("Logout",this.token),this.$router.push({path:"/login"}));var a=t.result?t.result:"上传失败";this.$message({message:a,type:"error"})},handleSuccess:function(t,e,o){this.uploadSuccessNum++,this.reportUploadForm.reportEnclosureName=e.name,this.reportUploadForm.reportEnclosurePhysicsUrl=t.imgList[0].imgPath,this.reportUploadForm.reportEnclosureVirtualUrl=t.imgList[0].imgUrl,this.uploadSuccessNum===this.uploadNum&&(this.submitFlag=!0),this.submitFlag&&this.saveUploadData()},downloadOpen:function(){this.dialogTitle="下载",this.downloadDialogVisible=!0,this.reportDownloadForm.reportYear=this.formatDate((new Date).getTime(),"yyyy")},download:function(){var t=this;this.$refs.reportDownloadForm.validate(function(e){if(!e)return!1;Object(s.c)(t.reportDownloadForm.reportYear).then(function(e){Object(s.a)(e).then(function(e){o("3UNf")(e,decodeURIComponent(sessionStorage.getItem("CADdownloadFileName"))),t.downloadDialogVisible=!1}).catch(function(e){var o=e.result?e.result:"暂无上报文件！";t.$message({message:o,type:"error"})})}).catch(function(e){var o=e.result?e.result:"年度上报文件获取失败";t.$message({message:o,type:"error"})})})},clearForm:function(t){for(var e in t){var o=this.getDataType(t[e]);if("String"===o)t[e]="";else if("Array"===o)t[e]=[];else if("Object"===o){r()(t[e]).length>0?this.clearForm(t[e]):t[e]={}}else t[e]=null}},uploadDialogOpen:function(){var t=this;this.$nextTick(function(){t.$refs.reportUploadForm.clearValidate()})},templateDialogClosed:function(){this.templateCheckList=""},uploadDialogClosed:function(){this.clearForm(this.reportUploadForm),this.reportUploadForm.haveFile="",this.fileList=[],this.uploadNum=0,this.uploadSuccessNum=0,this.submitFlag=!1,this.isReported=!1},downloadDialogClosed:function(){this.reportDownloadForm.reportYear=""},getDataType:function(t){var e=!0,o=!1,a=void 0;try{for(var n,r=i()(["String","Object","Number","Array","Function"]);!(e=(n=r.next()).done);e=!0){var s=n.value;if(Object.prototype.toString.call(t)==="[object "+s+"]")return s}}catch(t){o=!0,a=t}finally{try{!e&&r.return&&r.return()}finally{if(o)throw a}}},formatDate:function(t,e){var o=new Date(t),a=e||"yyyy-MM-dd",i={"M+":o.getMonth()+1,"d+":o.getDate(),"h+":o.getHours(),"m+":o.getMinutes(),"s+":o.getSeconds(),"q+":Math.floor((o.getMonth()+3)/3),S:o.getMilliseconds()};for(var n in/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(o.getFullYear()+"").substr(4-RegExp.$1.length))),i)new RegExp("("+n+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?i[n]:("00"+i[n]).substr((""+i[n]).length)));return a}}}}).call(e,o("7t+N"))},aEtF:function(t,e,o){"use strict";var a={props:{text:{type:String,default:"上传"},fontSize:{type:Number,default:16},marginLeft:{type:Number,default:180},padding:{type:String,default:"7px 22px"},showIcon:{type:Boolean,default:!1}},data:function(){return{style:{padding:this.padding,"font-size":this.fontSize+"px","margin-left":this.marginLeft+"px"}}},directives:{debounce:{inserted:function(t,e){var o=void 0;t.addEventListener("click",function(){o&&clearTimeout(o),o=setTimeout(function(){e.value()},300)})}}},methods:{clickBtn:function(){this.$emit("clickBtn")}}},i={render:function(){var t=this.$createElement,e=this._self._c||t;return e("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:this.clickBtn,expression:"clickBtn"}],staticClass:"upload-btn",style:this.style,attrs:{type:"primary",size:"medium"}},[this.showIcon?e("i",{staticClass:"el-icon-upload2"}):this._e(),this._v("\n  "+this._s(this.text)+"\n")])},staticRenderFns:[]},n=o("VU/8")(a,i,!1,null,null,null);e.a=n.exports},vgg6:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=o("R4mH"),i={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"dataReport"}},[o("div",{staticClass:"query-box",attrs:{id:"queryBox"}},[o("div",{staticClass:"clearfix"},[o("div",{staticClass:"query-item"},[o("div",{staticClass:"query-title"},[t._v("年份：")]),t._v(" "),o("div",{staticClass:"query-input"},[o("el-date-picker",{attrs:{type:"year",placeholder:"选择年份",format:"yyyy 年","value-format":"yyyy"},model:{value:t.reportYear,callback:function(e){t.reportYear=e},expression:"reportYear"}})],1)]),t._v(" "),o("div",{staticClass:"query-item",staticStyle:{"margin-left":"50px"}},[o("div",{staticClass:"query-title"},[t._v("状态：")]),t._v(" "),o("div",{staticClass:"query-input"},[o("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择状态"},model:{value:t.state,callback:function(e){t.state=e},expression:"state"}},t._l(t.stateOpts,function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1)]),t._v(" "),o("div",{staticClass:"query-item",staticStyle:{"margin-left":"50px"}},[o("div",{staticClass:"query-title"},[t._v("单位名称：")]),t._v(" "),o("div",{staticClass:"query-input"},[o("el-input",{attrs:{placeholder:"请输入单位名称"},model:{value:t.unitName,callback:function(e){t.unitName="string"==typeof e?e.trim():e},expression:"unitName"}})],1)]),t._v(" "),o("div",{staticClass:"query-btn"},[o("search-btn",{on:{clickBtn:t.search}}),t._v(" "),o("reset-btn",{on:{clickBtn:t.reset}}),t._v(" "),o("download-btn",{attrs:{text:"模板下载",showIcon:!0,marginLeft:10},on:{clickBtn:t.templateDialogOpen}})],1)])]),t._v(" "),o("div",{staticClass:"table-box"},[o("table-component",{attrs:{tableData:t.tableData,tableHeight:t.tableHeight},on:{select:t.handleSelectionChange}},[o("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"reportUnitName",label:"单位名称",align:"center"}}),t._v(" "),o("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"isReport",label:"上报状态",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("div",[t._v(t._s(1===e.row.isReport?"已上报":"未上报"))])]}}])})],1),t._v(" "),o("div",{staticClass:"table-operate-box",attrs:{id:"operateBox"}},[o("div",{staticClass:"operate-btn"},[o("upload-btn",{attrs:{fontSize:14,marginLeft:0,padding:"7px 10px",showIcon:!0},on:{clickBtn:t.uploadOpen}}),t._v(" "),o("download-btn",{attrs:{fontSize:14,padding:"7px 10px",showIcon:!0,marginLeft:10},on:{clickBtn:t.downloadOpen}})],1),t._v(" "),o("div",{staticClass:"operate-pager"},[o("table-pagination",{attrs:{currentPage:t.currentPage,pageSize:t.pageSize,total:t.total},on:{"size-change":t.changeSize,"page-change":t.changePage}})],1)])],1),t._v(" "),o("el-dialog",{staticClass:"template-dialog",attrs:{visible:t.templateDialogVisible,"close-on-click-modal":!1,width:"780px",center:!0},on:{"update:visible":function(e){t.templateDialogVisible=e},closed:t.templateDialogClosed}},[o("div",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[o("span",[t._v(t._s(t.dialogTitle))])]),t._v(" "),o("div",{staticClass:"dialog-content"},[o("el-radio-group",{model:{value:t.templateCheckList,callback:function(e){t.templateCheckList=e},expression:"templateCheckList"}},t._l(t.templateList,function(e,a){return o("el-radio",{key:a,attrs:{label:e.downloadTemplateVirtualUrl}},[t._v(t._s(e.downloadTemplateName))])}))],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("cancel-btn",{attrs:{fontSize:14},on:{clickBtn:function(e){t.templateDialogVisible=!1}}}),t._v(" "),o("confirm-btn",{attrs:{fontSize:14},on:{clickBtn:t.templateDownLoad}})],1)]),t._v(" "),o("el-dialog",{staticClass:"upload-dialog",attrs:{visible:t.uploadDialogVisible,"close-on-click-modal":!1,width:"780px",center:!0},on:{"update:visible":function(e){t.uploadDialogVisible=e},open:t.uploadDialogOpen,closed:t.uploadDialogClosed}},[o("div",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[o("span",[t._v(t._s(t.dialogTitle))])]),t._v(" "),o("div",{staticClass:"dialog-content"},[o("el-form",{ref:"reportUploadForm",attrs:{model:t.reportUploadForm,rules:t.reportUploadRules}},[o("el-form-item",{attrs:{label:"上报单位：","label-width":"105px",prop:"reportId"}},[o("el-select",{staticStyle:{width:"200px"},attrs:{filterable:"",placeholder:"请选择上报单位",size:"small"},model:{value:t.reportUploadForm.reportId,callback:function(e){t.$set(t.reportUploadForm,"reportId",e)},expression:"reportUploadForm.reportId"}},t._l(t.reportUnitOpts,function(t){return o("el-option",{key:t.reportId,attrs:{label:t.reportUnitName,value:t.reportId}})}))],1),t._v(" "),o("el-form-item",{attrs:{label:"上传文件：","label-width":"105px",prop:"haveFile"}},[o("div",{staticClass:"report-file-upload"},[o("el-upload",{ref:"upload",attrs:{headers:t.postHeaders,action:t.uploadUrl,"file-list":t.fileList,"auto-upload":!1,accept:t.acceptType,limit:t.limit,"on-success":t.handleSuccess,"on-remove":t.handleRemove,"on-change":t.handleChange,"on-error":t.handleError,"on-exceed":t.handleExceed,"before-upload":t.beforeAvatarUpload}},[o("i",{staticClass:"iconfont upload-icon"},[t._v("")]),t._v(" "),o("el-button",{attrs:{slot:"trigger",size:"small",type:"primary",disabled:1===t.fileList.length},slot:"trigger"},[t._v("点击选择文件")])],1)],1)])],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("cancel-btn",{attrs:{fontSize:14},on:{clickBtn:function(e){t.uploadDialogVisible=!1}}}),t._v(" "),o("confirm-btn",{attrs:{fontSize:14},on:{clickBtn:t.submitUploadData}})],1)]),t._v(" "),o("el-dialog",{staticClass:"download-dialog",attrs:{visible:t.downloadDialogVisible,"close-on-click-modal":!1,width:"780px",center:!0},on:{"update:visible":function(e){t.downloadDialogVisible=e},closed:t.downloadDialogClosed}},[o("div",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[o("span",[t._v(t._s(t.dialogTitle))])]),t._v(" "),o("div",{staticClass:"dialog-content"},[o("el-form",{ref:"reportDownloadForm",attrs:{model:t.reportDownloadForm,rules:t.reportDownloadRules,inline:""}},[o("el-form-item",{attrs:{label:"选择年份：","label-width":"105px",prop:"reportYear"}},[o("el-date-picker",{attrs:{type:"year",placeholder:"选择年份",format:"yyyy 年","value-format":"yyyy"},model:{value:t.reportDownloadForm.reportYear,callback:function(e){t.$set(t.reportDownloadForm,"reportYear",e)},expression:"reportDownloadForm.reportYear"}})],1)],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("cancel-btn",{attrs:{fontSize:14},on:{clickBtn:function(e){t.downloadDialogVisible=!1}}}),t._v(" "),o("confirm-btn",{attrs:{fontSize:14},on:{clickBtn:t.download}})],1)])],1)},staticRenderFns:[]};var n=function(t){o("Pf99")},r=o("VU/8")(a.a,i,!1,n,null,null);e.default=r.exports}});
//# sourceMappingURL=20.6b4ef2e198d4d480f795.js.map