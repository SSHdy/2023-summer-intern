webpackJsonp([38],{"7UkB":function(e,i,t){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("8u9Y"),s={render:function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{attrs:{id:"repairApply"}},[t("div",{staticClass:"query-box",attrs:{id:"queryBox"}},[t("div",{staticClass:"clearfix"},[t("div",{staticClass:"query-item",staticStyle:{"margin-right":"50px"}},[t("div",{staticClass:"query-title"},[e._v("申请编号：")]),e._v(" "),t("div",{staticClass:"query-input"},[t("el-input",{attrs:{placeholder:"请输入申请编号"},model:{value:e.repairApplyNo,callback:function(i){e.repairApplyNo=i},expression:"repairApplyNo"}})],1)]),e._v(" "),t("div",{staticClass:"query-item",staticStyle:{"margin-right":"50px"}},[t("div",{staticClass:"query-title"},[e._v("申请状态：")]),e._v(" "),t("div",{staticClass:"query-input"},[t("el-select",{attrs:{placeholder:"请选择申请状态",size:"small"},model:{value:e.applyStatus,callback:function(i){e.applyStatus=i},expression:"applyStatus"}},e._l(e.applyStatusOpts,function(e){return t("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})}))],1)]),e._v(" "),t("div",{staticClass:"query-item"},[t("div",{staticClass:"query-title"},[e._v("维修时间：")]),e._v(" "),t("div",{staticClass:"query-input"},[t("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期"},model:{value:e.startApplicationTime,callback:function(i){e.startApplicationTime=i},expression:"startApplicationTime"}})],1)]),e._v(" "),t("div",{staticClass:"query-item"},[t("div",{staticClass:"query-title",staticStyle:{"padding-right":"10px"}},[e._v("至")]),e._v(" "),t("div",{staticClass:"query-input"},[t("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd 23:59:59",placeholder:"选择日期"},model:{value:e.endApplicationTime,callback:function(i){e.endApplicationTime=i},expression:"endApplicationTime"}})],1)]),e._v(" "),t("div",{staticClass:"query-btn"},[t("search-btn",{on:{clickBtn:e.search}}),e._v(" "),t("reset-btn",{on:{clickBtn:e.reset}})],1)])]),e._v(" "),t("div",{staticClass:"table-box"},[t("table-component",{attrs:{tableData:e.tableData,tableHeight:e.tableHeight},on:{select:e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"50",align:"center"}}),e._v(" "),t("el-table-column",{attrs:{prop:"repairApplyNo",label:"申请编号",align:"center","show-overflow-tooltip":!0}}),e._v(" "),t("el-table-column",{attrs:{label:"使用单位",prop:"userUnits",align:"center",title:"userUnits","show-overflow-tooltip":!0}}),e._v(" "),t("el-table-column",{attrs:{prop:"repairModuleArea",label:"维修面积(m²)",align:"center","show-overflow-tooltip":!0}}),e._v(" "),t("el-table-column",{attrs:{prop:"repairApplyDate",label:"申请时间",align:"center","show-overflow-tooltip":!0}}),e._v(" "),t("el-table-column",{attrs:{prop:"repairProress",label:"施工进度",align:"center","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(e){return[t("el-progress",{attrs:{percentage:e.row.repairProgress,"text-inside":!0,"stroke-width":12}})]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"applyStatus",label:"申请状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("div",{class:{notAudit:"未审核"===i.row.applyStatus,passAudit:"审核通过"===i.row.applyStatus,failedAudit:"审核未通过"===i.row.applyStatus,Auditing:"审核中"===i.row.applyStatus}},[t("span",[e._v(e._s(i.row.applyStatus))])])]}}])}),e._v(" "),t("el-table-column",{attrs:{label:"审批",width:"90",align:"center"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("single-btn-group",{attrs:{isShowLook:!0,isShowAlter:!1,isShowDetail:!1,isShowDelete:!1},on:{lookClick:function(t){e.singleLook(i.row)}}})]}}])}),e._v(" "),t("el-table-column",{attrs:{label:"操作",width:"140",align:"center"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("single-btn-group",{class:{pl:"未审核"!==i.row.applyStatus},attrs:{isShowAlter:"未审核"===i.row.applyStatus,isShowDetail:!0,isShowDelete:!1},on:{updateClick:function(t){e.singleUpdate(i.row)},detailClick:function(t){e.singleDetail(i.row)}}})]}}])})],1),e._v(" "),t("div",{staticClass:"table-operate-box",attrs:{id:"operateBox"}},[t("div",{staticClass:"operate-btn"},[t("table-btn-group",{attrs:{batchDelBtnShow:!1},on:{addClick:e.addUnit}})],1),e._v(" "),t("div",{staticClass:"operate-pager"},[t("table-pagination",{attrs:{currentPage:e.currentPage,pageSize:e.pageSize,total:e.total},on:{"size-change":e.changeSize,"page-change":e.changePage}})],1)])],1),e._v(" "),t("el-dialog",{attrs:{visible:e.dialogVisible,"close-on-click-modal":!1,width:"1100px",center:!0},on:{"update:visible":function(i){e.dialogVisible=i},open:e.dialogOpen,closed:e.dialogClosed}},[t("div",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[t("span",[e._v(e._s(e.title))])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.lookFlag,expression:"lookFlag"}]},[t("div",{staticClass:"query-box",attrs:{id:"queryBox"}},[t("div",{staticClass:"clearfix dialog"},[t("div",{staticClass:"query-item"},[t("div",{staticClass:"query-title"},[e._v(e._s("detail"==e.operateType?"使用单位：":"使用单位"))]),e._v(" "),t("div",{staticClass:"query-input"},["detail"!==e.operateType?t("el-select",{attrs:{multiple:"","popper-class":"unit",placeholder:"请选择使用单位"},model:{value:e.unitIdList,callback:function(i){e.unitIdList=i},expression:"unitIdList"}},e._l(e.unitOptions,function(e){return t("el-option",{key:e.unitId,attrs:{label:e.unitName,value:e.unitId}})})):e._e(),e._v(" "),"detail"==e.operateType?t("el-input",{class:{"detail-form-item":"detail"===e.operateType},staticStyle:{width:"200px"},attrs:{readonly:"detail"===e.operateType,title:e.unitIdLists},model:{value:e.unitIdLists,callback:function(i){e.unitIdLists=i},expression:"unitIdLists"}}):e._e()],1)]),e._v(" "),"detail"==e.operateType?t("div",{staticClass:"query-item"},[t("div",{staticClass:"query-title"},[e._v("申请人：")]),e._v(" "),t("div",{staticClass:"query-input"},[t("el-input",{class:{"detail-form-item":"detail"===e.operateType},staticStyle:{width:"200px"},attrs:{readonly:"detail"===e.operateType},model:{value:e.repairApplicant,callback:function(i){e.repairApplicant=i},expression:"repairApplicant"}})],1)]):e._e(),e._v(" "),"detail"==e.operateType?t("div",{staticClass:"query-item"},[t("div",{staticClass:"query-title"},[e._v("申请时间：")]),e._v(" "),t("div",{staticClass:"query-input"},[t("el-input",{class:{"detail-form-item":"detail"===e.operateType},staticStyle:{width:"200px"},attrs:{readonly:"detail"===e.operateType},model:{value:e.repairApplyDate,callback:function(i){e.repairApplyDate=i},expression:"repairApplyDate"}})],1)]):e._e(),e._v(" "),"detail"==e.operateType?t("div",{staticClass:"query-item"},[t("div",{staticClass:"query-title"},[e._v("维修状态：")]),e._v(" "),t("div",{staticClass:"query-input"},[t("el-input",{class:{"detail-form-item":"detail"===e.operateType},staticStyle:{width:"200px"},attrs:{readonly:"detail"===e.operateType},model:{value:e.applyStatus,callback:function(i){e.applyStatus=i},expression:"applyStatus"}})],1)]):e._e()])]),e._v(" "),t("div",{staticClass:"query-box",attrs:{id:"queryBox"}},[t("div",{staticClass:"clearfix",staticStyle:{"border-bottom":"1px solid #ccc"}},["detail"!==e.operateType?t("div",{staticClass:"query-left"},[e._v("添加维修：")]):t("div",{staticClass:"query-left"},[e._v("维修记录：")]),e._v(" "),t("div",{staticClass:"query-right"},["detail"!==e.operateType?t("span",{on:{click:function(i){e.resetRepaireContent("Form")}}},[t("i",{staticClass:"iconfont"},[e._v("")]),e._v(" 重置\n            ")]):e._e(),e._v(" "),"add"==e.operateType?t("span",{on:{click:function(i){e.addRepaireContent("Form")}}},[t("i",{staticClass:"el-icon-circle-plus-outline"}),e._v(" 新增\n            ")]):e._e(),e._v(" "),t("el-popover",{staticClass:"detail",attrs:{placement:"bottom-end",width:"300",trigger:"click","popper-class":"More-info","visible-arrow":!1},model:{value:e.popoverRepairInfo,callback:function(i){e.popoverRepairInfo=i},expression:"popoverRepairInfo"}},[t("ul",{staticClass:"repair-info-more"},e._l(e.repairModuleList,function(i,r){return t("li",{key:r,class:{"info-active":e.activeInfo===r},on:{click:function(i){e.showInfoDetail(r)}}},[e._v(e._s(i.repairModule.positionStr))])})),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.repairModuleList.length>0,expression:"repairModuleList.length > 0"}],staticClass:"more-btn",attrs:{slot:"reference"},slot:"reference"},[e._v("\n                更多\n                "),t("i",{staticClass:"el-icon-arrow-down"})])])],1)])]),e._v(" "),t("el-form",{ref:"Form",attrs:{inline:!0,model:e.Form,rules:e.rules}},[t("el-form-item",{class:{"detail-form-item":"detail"===e.operateType},attrs:{label:"detail"===e.operateType?"维修部位：":"维修部位","label-width":"120px",prop:"repairPartId"}},["detail"!==e.operateType?t("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择维修部位"},model:{value:e.Form.repairPartId,callback:function(i){e.$set(e.Form,"repairPartId",i)},expression:"Form.repairPartId"}},e._l(e.repairePartOpts,function(e,i){return t("el-option",{key:i,attrs:{label:e.repairPartName,value:e.repairPartsId}})})):e._e(),e._v(" "),"detail"===e.operateType?t("el-input",{attrs:{size:"small",readonly:"detail"===e.operateType},model:{value:e.Form.repairPartId,callback:function(i){e.$set(e.Form,"repairPartId",i)},expression:"Form.repairPartId"}}):e._e()],1),e._v(" "),t("el-form-item",{class:{"detail-form-item":"detail"===e.operateType},attrs:{label:"detail"===e.operateType?"坐落及楼栋：":"坐落及楼栋","label-width":"120px",prop:"repairModulePosition"}},[t("el-input",{attrs:{size:"small",placeholder:"detail"==e.operateType?"":"请输入坐落及楼栋",readonly:"detail"===e.operateType},model:{value:e.Form.repairModulePosition,callback:function(i){e.$set(e.Form,"repairModulePosition",i)},expression:"Form.repairModulePosition"}})],1),e._v(" "),t("el-form-item",{class:{"detail-form-item":"detail"===e.operateType},attrs:{label:"detail"===e.operateType?"维修内容：":"维修内容","label-width":"120px",prop:"repairModuleTarget"}},[t("el-input",{attrs:{size:"small",placeholder:"detail"==e.operateType?"":"请输入维修内容",readonly:"detail"===e.operateType},model:{value:e.Form.repairModuleTarget,callback:function(i){e.$set(e.Form,"repairModuleTarget",i)},expression:"Form.repairModuleTarget"}})],1),e._v(" "),t("el-form-item",{class:{"detail-form-item":"detail"===e.operateType},attrs:{label:"detail"===e.operateType?"具体方位：":"具体方位","label-width":"120px",prop:"RepaireYard"}},["detail"!==e.operateType?t("tree-select",{attrs:{treeShow:e.treeShow,inputWidth:"200px",inputHeight:"34px"},on:{loadNode:e.loadNode,handleCheckChange:e.handleCheckChange,handleNodeExpand:e.handleNodeExpand}}):e._e(),e._v(" "),"detail"===e.operateType?t("el-input",{attrs:{size:"small",readonly:"detail"===e.operateType},model:{value:e.Form.RepairYard,callback:function(i){e.$set(e.Form,"RepairYard",i)},expression:"Form.RepairYard"}}):e._e()],1),e._v(" "),t("el-form-item",{class:{"detail-form-item":"detail"===e.operateType},attrs:{label:"detail"===e.operateType?"维修面积(m²)：":"维修面积(m²)","label-width":"120px",prop:"repairModuleArea"}},[t("el-input",{attrs:{size:"small",placeholder:"detail"==e.operateType?"":"请输入维修面积",readonly:"detail"===e.operateType},on:{blur:function(i){e.limitFloat("repairModuleArea",!0)}},nativeOn:{keyup:function(i){e.limitFloat("repairModuleArea")}},model:{value:e.Form.repairModuleArea,callback:function(i){e.$set(e.Form,"repairModuleArea",i)},expression:"Form.repairModuleArea"}})],1),e._v(" "),t("el-form-item",{class:{"detail-form-item":"detail"===e.operateType},staticStyle:{display:"block"},attrs:{label:"detail"===e.operateType?"照片：":"照片","label-width":"120px",prop:"picture"}},["detail"!==e.operateType?t("div",{staticClass:"upload_box"},[t("el-upload",{ref:"upload",attrs:{headers:e.postHeaders,action:e.uploadImgUrl,"list-type":"picture-card","file-list":e.fileList,"on-remove":e.handleRemove,"auto-upload":!1,"on-success":e.handleSuccess,"on-change":e.handleChange,"on-error":e.handleError,accept:e.acceptImgType,limit:e.limitImgNum,"on-exceed":e.handleExceed,"before-upload":e.beforeAvatarUpload,multiple:""}},[t("i",{staticClass:"el-icon-plus"})])],1):e._e(),e._v(" "),"detail"===e.operateType?t("div",{staticClass:"img-preview-box clearfix",staticStyle:{"padding-top":"13px"}},e._l(e.detailFileList,function(i,r){return t("div",{key:r,staticClass:"img-preview-item",on:{click:function(t){e.preview(i.virtualAddress)}}},[t("img",{attrs:{src:e.getImgUrl(i.virtualAddress),alt:"已上传证件"}}),e._v(" "),t("div",{staticClass:"bigger-view-warpper"},[t("i",{staticClass:"bigger-view-icon"})]),e._v(" "),t("el-checkbox",{on:{change:function(t){e.imgCheckboxChange(t,i.physicalAddress)}}})],1)})):e._e(),e._v(" "),e.detailFileList.length?t("el-button",{attrs:{type:"primary",icon:"el-icon-download"},on:{click:e.downloadImg}},[e._v("下载图片")]):e._e()],1)],1),e._v(" "),t("div",{staticClass:"operate_btn"},[t("span",{directives:[{name:"show",rawName:"v-show",value:e.editFlag||"edit"==e.operateType||e.dealFlag,expression:"editFlag || operateType == 'edit' ||dealFlag "}],on:{click:function(i){e.editRepaireContent("Form")}}},[t("i",{staticClass:"iconfont"},[e._v("")]),e._v("修改\n        ")])])],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.lookFlag,expression:"!lookFlag"}],staticStyle:{"text-align":"center","font-size":"20px",color:"#ff3040"}},[e._v("该维修记录已被删除")]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:"detail"!==e.operateType&&e.lookFlag,expression:"operateType!=='detail'&&lookFlag"}],staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("cancel-btn",{attrs:{fontSize:14},on:{clickBtn:function(i){e.dialogVisible=!1}}}),e._v(" "),t("confirm-btn",{attrs:{fontSize:14},on:{clickBtn:function(i){e.submitForm("Form")}}})],1)]),e._v(" "),t("el-dialog",{attrs:{visible:e.DialogVisible,"close-on-click-modal":!1,width:"780px",center:!0},on:{"update:visible":function(i){e.DialogVisible=i},closed:e.Closed}},[t("div",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[t("span",[e._v(e._s(e.title))])]),e._v(" "),t("el-steps",{attrs:{active:e.applyStepActive,"align-center":"","finish-status":"success",space:100,direction:"vertical"}},e._l(e.applyProcess,function(i,r){return t("el-step",{key:r},[t("div",{attrs:{slot:"description"},slot:"description"},[t("div",[t("span",[e._v("流程：")]),e._v("\n            "+e._s(i.stepName)+"\n          ")]),e._v(" "),t("div",{class:{hidden:!i.transactors}},[t("span",[e._v("操作人：")]),e._v("\n            "+e._s(i.transactors)+"\n          ")]),e._v(" "),t("div",{class:{hidden:!i.processingTime}},[t("span",[e._v("操作时间：")]),e._v("\n            "+e._s(i.processingTime)+"\n          ")])])])}))],1)],1)},staticRenderFns:[]};var a=function(e){t("8nP7")},o=t("VU/8")(r.a,s,!1,a,null,null);i.default=o.exports},"8nP7":function(e,i){},"8u9Y":function(e,i,t){"use strict";(function(e){var r=t("BO1k"),s=t.n(r),a=t("fZjL"),o=t.n(a),d=t("mvHQ"),l=t.n(d),p=t("u3Mf"),u=t("Oizb"),h=t("HI+P"),n=t("zu8U"),m=t("yzMb"),c=t("5kkW"),I=t("3a1n"),L=t("FAvH"),g=t("uSev"),M=t("GR1E"),f=t("dO4M"),v=t("fYBn"),y=t("02tb"),F=t("gAs1"),b=(t.n(F),t("N+Om")),N=(t.n(b),t("WHmA")),S=t("162o"),x=(t.n(S),t("OMJi"));t.n(x);i.a={components:{treeSelect:N.a,singleBtnGroup:f.a,tableComponent:g.a,tableBtnGroup:L.a,tablePagination:M.a,cancelBtn:v.a,confirmBtn:y.a,searchBtn:c.a,resetBtn:I.a},data:function(){var e=this;return{editFlag:!1,dealFlag:!1,activeInfo:0,popoverRepairInfo:!1,currentLevel:null,flag:!1,Form:{positionStr:"",repairModuleId:"",repairModuleTarget:"",repairModuleArea:"",repairPartId:"",buildId:"",floorName:"",houseId:"",yardId:"",addressList:[],RepairYard:"",RepaireYard:"",repairModulePosition:"",picture:""},deleteRepairImgIdList:[],treeShow:!1,treeData:[],checkedNodes:[],houseIdList:[],houseNameList:[],expandIdList:[],houseNumber:"",uploadImgNum:0,uploadedImgNum:0,uploadSuccessImgNum:0,detailFileList:[],fileList:[],oldFileList:[],token:"",postHeaders:{Authorization:""},limitImgNum:5,acceptImgType:"image/jpeg,image/gif,image/png,image/bmp",uploadImgUrl:u.n+"?uploadType=propertyRights",operateType:"add",userUnit:"",dialogTitle:"",dialogVisible:!1,dialogVisibles:!1,DialogVisible:!1,notAudit:!1,passAudit:!1,failedAudit:!1,Auditing:!1,currentPage:1,pageSize:15,total:1,repairApplyNo:"",applyStatus:"",startApplicationTime:"",endApplicationTime:"",userId:null,loading:!1,tableHeight:0,tableData:[],RepaireContentList:[],applyStatusOpts:[{text:"未审核",value:0},{text:"审核通过",value:1},{text:"审核未通过",value:2},{text:"审核中",value:3}],userIds:["13"],removeUserIds:[],deleteUnitIdList:[],unitIdList:[],unitIdLists:"",repairApplicantId:[],repairModuleList:[],repairModule:[],unitOptions:[],repairApplyNum:"",repairApplicant:"",repairApplyDate:"",repaireStatus:"",repairePartOpts:[],title:"",downloadList:[],submitFlag:!1,applyStepActive:0,rules:{repairPartId:[{required:!0,message:"维修部位不能为空",trigger:"blur"}],RepaireYard:[{required:!0,validator:function(i,t,r){"detail"!=e.operateType&&(e.Form.RepaireYard?r():r(new Error("具体方位不能为空")))},trigger:"blur"}],repairModulePosition:[{required:!0,message:"坐落及楼栋不能为空",trigger:"blur"}],repairModuleTarget:[{required:!0,message:"维修内容不能为空",trigger:"blur"}],repairModuleArea:[{required:!0,message:"维修面积不能为空",trigger:"blur"}],picture:[{required:!0,validator:function(i,t,r){e.Form.picture?r():r(new Error("请先上传图片"))},trigger:"blur"}]},applyProcess:[],active:null,indexs:0,lookFlag:!0}},methods:{loadingStart:function(e){this.loading=this.$loading({lock:!0,text:"正在加载...",spinner:"el-icon-loading",target:e,customClass:"loading-box"})},loadingEnd:function(){this.loading.close()},getList:function(){var e=this;this.loadingStart(".table-box"),this.startApplicationTime&&this.endApplicationTime&&new Date(this.endApplicationTime)<new Date(this.startApplicationTime)?this.$message({message:"开始日期不能大于结束日期!",type:"warning"}):(this.userId=parseInt(sessionStorage.getItem("userId")),Object(h.n)(this.currentPage,this.endApplicationTime,this.pageSize,this.repairApplyNo,this.startApplicationTime,this.userId,this.applyStatus).then(function(i){e.total=i.total,i.records.forEach(function(i){0==i.applyStatus&&(i.applyStatus="未审核"),1==i.applyStatus&&(i.applyStatus="审核通过"),2==i.applyStatus&&(i.applyStatus="审核未通过"),3==i.applyStatus&&(i.applyStatus="审核中"),i.repairApplyDate&&(i.repairApplyDate=e.formatDate(i.repairApplyDate)),i.unitNameList&&(i.userUnits=i.unitNameList.join(","))}),e.tableData=i.records,e.loadingEnd()}).catch(function(i){var t=i.result?i.result:"获取列表失败";e.$message({message:t,type:"error"}),e.loadingEnd()}))},search:function(){this.currentPage=1,this.getList()},reset:function(){this.currentPage=1,this.repairApplyNo="",this.applyStatus=null,this.startApplicationTime="",this.endApplicationTime="",this.getList()},handleSelectionChange:function(e){this.selectData=e},addUnit:function(){this.operateType="add",this.title="新增维修信息",this.dialogVisible=!0,this.getUnit(),this.RepaireContentList=[],this.treeShow=!0,this.getRepairPart()},changeSize:function(e){this.currentPage=1,this.pageSize=e,this.getList()},changePage:function(e){this.currentPage=e,this.getList()},getUnit:function(){var e=this;Object(h.z)().then(function(i){e.unitOptions=i}).catch(function(i){var t=i.result?i.result:"获取详情列表失败";e.$message({message:t,type:"error"})})},getRepairPart:function(){var e=this;Object(h.v)().then(function(i){e.repairePartOpts=i}).catch(function(i){var t=i.result?i.result:"获取闲置住房失败";e.$message({message:t,type:"error"})})},singleDetail:function(e){var i=this;this.repairApplyId=e.repairApplyId,this.operateType="detail",this.title="维修信息详情",this.dialogVisible=!0,this.getUnit(),this.getRepairPart(),Object(h.m)(e.repairApplyId).then(function(e){if(e){e.repairModuleDetailList.forEach(function(e){var t={repairModule:{}};t.addressList=e.repairImgList,t.deleteRepairImgIdList=i.deleteRepairImgIdList,t.repairModule.houseId=e.houseId?e.houseId:"",t.repairModule.floorName=e.floorName?e.floorName:"",t.repairModule.buildId=e.buildId?e.buildId:"",t.repairModule.yardId=e.yardId?e.yardId:"",t.repairModule.repairModuleTarget=e.repairModuleTarget,t.repairModule.repairModuleArea=e.repairModuleArea,t.repairModule.repairModuleId=e.repairModuleId,t.repairModule.repairPartName=e.repairPartName,t.repairModule.positionStr=e.positionStr,t.repairModule.repairModulePosition=e.repairModulePosition,i.repairModuleList.push(t)});i.unitIdLists=e.unitNameList.length>0?e.unitNameList.join(","):e.unitNameList[0],i.repairApplicant=e.repairApplicant,i.applyStatus=["未审核","审核通过","审核不通过","审核中"][e.applyStatus],i.repairApplyDate=e.repairApplyDate,i.Form.repairModuleTarget=e.repairModuleDetailList[0].repairModuleTarget,i.Form.repairModulePosition=e.repairModuleDetailList[0].repairModulePosition,i.repairePartOpts.forEach(function(t){t.repairPartsId===e.repairModuleDetailList[0].repairPartId&&(i.Form.repairPartId=t.repairPartName)}),i.Form.RepairYard=e.repairModuleDetailList[0].positionStr,i.Form.repairModuleArea=e.repairModuleDetailList[0].repairModuleArea,e.repairModuleDetailList[0].repairImgList.length>0&&e.repairModuleDetailList[0].repairImgList.forEach(function(e,t){var r=e.virtualAddress.split(".")[1];"rar"!==r&&"zip"!==r||(e.virtualAddress="/images/compress.png"),i.detailFileList.push(e)})}else i.lookFlag=!1}).catch(function(e){var t=e.result?e.result:"获取维修申请详情失败";i.$message({message:t,type:"error"})})},singleUpdate:function(e){var i=this;this.repairApplyId=e.repairApplyId,this.operateType="edit",this.title="修改维修信息",this.dialogVisible=!0,this.dialogTitle="修改维修信息",this.getUnit(),this.RepaireContentList=[],this.treeShow=!0,this.getRepairPart(),Object(h.m)(e.repairApplyId).then(function(e){e?(e.repairModuleDetailList.forEach(function(e){var t={repairModule:{},addressList:[]};t.addressImgList=e.repairImgList,t.deleteRepairImgIdList=[],t.repairModule.houseId=e.houseId?e.houseId:"",t.repairModule.houseNumber=e.houseNumber?e.houseNumber:"",t.repairModule.floorName=e.floorName?e.floorName:"",t.repairModule.buildId=e.buildId?e.buildId:"",t.repairModule.buildName=e.buildName?e.buildName:"",t.repairModule.yardId=e.yardId?e.yardId:"",t.repairModule.yardName=e.yardName?e.yardName:"",t.repairModule.repairModuleTarget=e.repairModuleTarget,t.repairModule.repairModuleArea=e.repairModuleArea,t.repairModule.repairModuleId=e.repairModuleId,t.repairModule.repairPartId=e.repairPartId?e.repairPartId:"",t.repairModule.positionStr=e.positionStr?e.positionStr:"",t.repairModule.repairModulePosition=e.repairModulePosition?e.repairModulePosition:"",i.repairModuleList.push(t)}),i.unitOptions.forEach(function(t){e.unitNameList.forEach(function(r,s){t.unitName==e.unitNameList[s]&&i.unitIdList.push(t.unitId)})}),i.showForm(i.indexs)):i.lookFlag=!1}).catch(function(e){var t=e.result?e.result:"维修申请详情获取失败";i.$message({message:t,type:"error"})})},showForm:function(e){var i=this;if(this.Form.repairModuleId=this.repairModuleList[e].repairModule.repairModuleId?this.repairModuleList[e].repairModule.repairModuleId:"",this.Form.repairModuleTarget=this.repairModuleList[e].repairModule.repairModuleTarget?this.repairModuleList[e].repairModule.repairModuleTarget:"",this.Form.repairModuleArea=this.repairModuleList[e].repairModule.repairModuleArea?this.repairModuleList[e].repairModule.repairModuleArea:"",this.Form.repairModulePosition=this.repairModuleList[e].repairModule.repairModulePosition?this.repairModuleList[e].repairModule.repairModulePosition:"",this.Form.repairPartId=this.repairModuleList[e].repairModule.repairPartId?this.repairModuleList[e].repairModule.repairPartId:"",this.Form.positionStr=this.repairModuleList[e].repairModule.positionStr?this.repairModuleList[e].repairModule.positionStr:"",this.repairModuleList[e].addressImgList&&this.repairModuleList[e].addressImgList.length>0){var t=0;this.repairModuleList[e].addressImgList.length>0&&(this.Form.submitFlag="true"),this.repairModuleList[e].addressImgList.forEach(function(e){t++;var r=e.virtualAddress.split(".")[1];"rar"!==r&&"zip"!==r||(e.virtualAddress="/images/compress.png");var s={name:e.repairImgId,url:p.a+p.f+e.virtualAddress+"?access_token="+i.token,physics:e.physicalAddress};i.fileList.push(s),i.oldFileList.push(s)}),this.fileList.length>0&&(this.Form.picture="true"),this.uploadedImgNum=t}this.repairModuleList[e].repairModule.houseId?(this.Form.yardId=this.repairModuleList[e].repairModule.yardId,this.Form.buildId=this.repairModuleList[e].repairModule.buildId,this.Form.floorName=this.repairModuleList[e].repairModule.floorName,this.Form.houseId=this.repairModuleList[e].repairModule.houseId,this.houseNameList.push(this.repairModuleList[e].repairModule.houseNumber),this.houseIdList.push(""+this.repairModuleList[e].repairModule.houseId),this.expandIdList.push(this.repairModuleList[e].repairModule.yardId,this.repairModuleList[e].repairModule.buildId,this.repairModuleList[e].repairModule.floorName),m.a.$emit("setTreeSelectVal",this.houseNameList,this.houseIdList,this.expandIdList)):this.repairModuleList[e].repairModule.floorName?(this.Form.buildId=this.repairModuleList[e].repairModule.buildId,this.Form.floorName=this.repairModuleList[e].repairModule.floorName,this.houseNameList.push(this.repairModuleList[e].repairModule.floorName+"层"),this.houseIdList.push(this.repairModuleList[e].repairModule.yardId+":"+this.repairModuleList[e].repairModule.buildId+":"+this.repairModuleList[e].repairModule.floorName),this.expandIdList.push(this.repairModuleList[e].repairModule.buildId),m.a.$emit("setTreeSelectVal",this.houseNameList,this.houseIdList,this.expandIdList)):this.repairModuleList[e].repairModule.buildId?(this.Form.buildId=this.repairModuleList[e].repairModule.buildId,this.houseNameList.push(this.repairModuleList[e].repairModule.buildName),this.houseIdList.push(""+this.repairModuleList[e].repairModule.buildId),this.expandIdList.push(this.repairModuleList[e].repairModule.buildId),m.a.$emit("setTreeSelectVal",this.houseNameList,this.houseIdList,this.expandIdList)):this.repairModuleList[e].repairModule.yardId&&(this.Form.yardId=this.repairModuleList[e].repairModule.yardId,this.houseNameList.push(this.repairModuleList[e].repairModule.yardName),this.houseIdList.push(""+this.repairModuleList[e].repairModule.yardId),m.a.$emit("setTreeSelectVal",this.houseNameList,this.houseIdList)),this.houseNameList.length>0?this.Form.RepaireYard="true":this.Form.RepaireYard=""},submitForm:function(e){var i=this;this.$refs[e].validate(function(e){if(i.submitFlag=!0,!e)return!1;0===i.uploadImgNum?i.saveRepaireContent():i.submitUpload()})},saveForm:function(e){var i=this;if("add"==this.operateType){var t=[];this.repairApplicant=sessionStorage.getItem("name"),this.repairApplicantId=sessionStorage.getItem("userId"),this.repairModuleList.forEach(function(e){e.addressList.length>0&&t.push(e)}),Object(h.b)(this.removeUserIds,this.repairApplicant,this.repairApplicantId,t,this.unitIdList,this.userIds).then(function(e){i.dialogVisible=!1,i.getList(),i.$message({message:"新增维修申请成功!",type:"success"}),m.a.$emit("updateBacklogTips")}).catch(function(e){var t=e.result?e.result:"新增维修申请失败";i.$message({message:t,type:"error"})}),this.fileList=this.oldFileList}else if("edit"==this.operateType){var r=[];this.repairModuleList.forEach(function(e){r.push({addressList:e.repairModule.addressList,deleteRepairImgIdList:e.deleteRepairImgIdList,repairModule:e.repairModule})}),Object(h.G)(r,this.repairApplyId,this.unitIdList).then(function(e){i.dialogVisible=!1,i.getList(),i.$message({message:"修改维修申请成功!",type:"success"})}).catch(function(e){var t=e.result?e.result:"维修申请修改失败";i.$message({message:t,type:"error"})})}},addRepaireContent:function(e){var i=this;sessionStorage.removeItem("index"),this.submitFlag=!1,this.flag=!1,"detail"!=this.operateType&&this.$refs[e].validate(function(e){if(!e)return!1;0===i.uploadImgNum?i.saveRepaireContent():i.submitUpload()})},resetRepaireContent:function(){m.a.$emit("clearTreeSelectVal"),this.clearForm(this.Form),this.fileList=[],this.checkedNodes={},this.houseIdList=[],this.houseNameList=[],this.expandIdList=[],this.houseNumber="",this.uploadSuccessImgNum=0,this.uploadImgNum=0,this.submitFlag=!1},editRepaireContent:function(e){var i=this;"detail"!=this.operateType&&this.$refs[e].validate(function(e){if(!e)return!1;0===i.uploadImgNum?i.saveRepaireContent():i.submitUpload()})},saveRepaireContent:function(){var e=this;if("add"==this.operateType)if(this.editFlag){if(this.checkedNodes.type){if(this.checkedNodes.type){this.Form.positionStr=this.checkedNodes.address;var i={},t=[];this.Form.addressList.length>0&&this.Form.addressList.forEach(function(i){e.repairModuleList[e.activeInfo].addressList.push(i)}),this.repairModuleList[this.activeInfo].addressList.forEach(function(i,r){e.deleteRepairImgIdList.forEach(function(s,a){i.physicalAddress==s.physics&&(s.name?t.push(s.name):(e.deleteRepairImgIdList.splice(a,1),e.repairModuleList[e.activeInfo].addressList.splice(r,1)))})}),this.deleteRepairImgIdList=t,i.addressList=JSON.parse(l()(this.repairModuleList[this.activeInfo].addressList)),i.deleteRepairImgIdList=JSON.parse(l()(this.deleteRepairImgIdList)),this.repairePartOpts.forEach(function(i){i.repairPartsId==e.Form.repairPartId&&(e.Form.repairPartName=i.repairPartName)}),i.repairModule=JSON.parse(l()(this.Form)),this.repairModuleList[this.activeInfo]=i}}else{var r={},s=[];this.Form.addressList.length>0&&this.Form.addressList.forEach(function(i){e.repairModuleList[e.activeInfo].addressList.push(i)}),this.repairModuleList[this.activeInfo].addressList.forEach(function(i,t){e.deleteRepairImgIdList.forEach(function(r,a){i.physicalAddress==r.physics&&(r.name?s.push(r.name):(e.deleteRepairImgIdList.splice(a,1),e.repairModuleList[e.activeInfo].addressList.splice(t,1)))})}),this.deleteRepairImgIdList=s,r.addressList=JSON.parse(l()(this.repairModuleList[this.activeInfo].addressList)),r.deleteRepairImgIdList=JSON.parse(l()(this.deleteRepairImgIdList)),this.repairePartOpts.forEach(function(i){i.repairPartsId==e.Form.repairPartId&&(e.Form.repairPartName=i.repairPartName)}),r.repairModule=JSON.parse(l()(this.Form)),this.repairModuleList[this.activeInfo]=r,this.submitFlag&&this.saveForm()}this.editFlag=!1,m.a.$emit("clearTreeSelectVal"),this.clearForm(this.Form),this.fileList=[],this.checkedNodes={},this.houseIdList=[],this.houseNameList=[],this.expandIdList=[],this.houseNumber="",this.uploadSuccessImgNum=0,this.uploadImgNum=0,this.uploadedImgNum=0,this.submitFlag=!1}else if(this.checkedNodes.type){var a={};if(1==(a=this.checkedNodes).type)this.Form.positionStr=a.address,this.Form.yardId=a.id;else if(2==a.type){this.Form.positionStr=a.address;var o=a.id.split(":");this.Form.yardId=o[0],this.Form.buildId=o[1]}else if(3==a.type){this.Form.positionStr=a.address;var d=a.id.split(":");this.Form.yardId=d[0],this.Form.buildId=d[1],this.Form.floorName=d[2]}else if(4==a.type){this.Form.positionStr=a.address;var p=a._id.split(":")[(this.Form.yardId,this.Form.buildId,this.Form.floorName,this.Form.houseId)]=p}var u={};u.addressList=JSON.parse(l()(this.Form.addressList)),u.deleteRepairImgIdList=JSON.parse(l()(this.deleteRepairImgIdList)),this.repairePartOpts.forEach(function(i){i.repairPartsId==e.Form.repairPartId&&(e.Form.repairPartName=i.repairPartName)}),u.repairModule=JSON.parse(l()(this.Form)),this.dealFlag?this.repairModuleList[this.indexs]=u:this.repairModuleList.push(u),this.submitFlag&&this.saveForm(),m.a.$emit("clearTreeSelectVal"),this.clearForm(this.Form),this.fileList=[],this.checkedNodes={},this.houseIdList=[],this.houseNameList=[],this.expandIdList=[],this.houseNumber="",this.uploadSuccessImgNum=0,this.uploadImgNum=0,this.uploadedImgNum=0,this.submitFlag=!1}else{var h={},n=[];this.repairModuleList[this.activeInfo]={addressList:[]},this.Form.addressList.length>0&&this.Form.addressList.forEach(function(i){e.repairModuleList[e.activeInfo].addressList.push(i)}),this.repairModuleList[this.activeInfo].addressList.forEach(function(i,t){e.deleteRepairImgIdList.forEach(function(r,s){i.physicalAddress==r.physics&&(r.name?n.push(r.name):(e.deleteRepairImgIdList.splice(s,1),e.repairModuleList[e.activeInfo].addressList.splice(t,1)))})}),this.deleteRepairImgIdList=n,h.addressList=JSON.parse(l()(this.repairModuleList[this.activeInfo].addressList)),h.deleteRepairImgIdList=JSON.parse(l()(this.deleteRepairImgIdList)),this.repairePartOpts.forEach(function(i){i.repairPartsId==e.Form.repairPartId&&(e.Form.repairPartName=i.repairPartName)}),h.repairModule=JSON.parse(l()(this.Form)),this.repairModuleList[this.activeInfo]=h,this.submitFlag&&this.saveForm()}else if(this.checkedNodes.type){if(this.checkedNodes.type){var c=this.checkedNodes;1==c.type?(this.Form.yardId=c.id,this.Form.buildId="",this.Form.floorName="",this.Form.houseId="",this.Form.positionStr=c.address):2==c.type?(this.Form.positionStr=this.checkedNodes.address,this.Form.yardId=c.pid,this.Form.buildId=c.id.split(":")[1],this.Form.floorName="",this.Form.houseId=""):3==c.type?(this.Form.positionStr=this.checkedNodes.address,this.Form.yardId=c.id.split(":")[0],this.Form.buildId=c.id.split(":")[1],this.Form.floorName=c.id.split(":")[2],this.Form.houseId=""):(this.Form.positionStr=this.checkedNodes.address,this.Form.yardId=c._id.split(":")[0],this.Form.buildId=c._id.split(":")[1],this.Form.floorName=c._id.split(":")[2],this.Form.houseId=c._id.split(":")[3])}var I={};I.addressList=JSON.parse(l()(this.Form.addressList)),I.deleteRepairImgIdList=this.deleteRepairImgIdList,I.repairModule=JSON.parse(l()(this.Form)),this.repairModuleList[this.indexs]=I,this.submitFlag&&this.saveForm(),this.checkedNodes={},this.uploadSuccessImgNum=0}else{var L={deleteRepairImgIdList:[]};L.addressImgList=this.repairModuleList[this.indexs].addressImgList,0==this.Form.addressList.length?L.addressList=[]:this.Form.addressList.forEach(function(e){L.addressImgList.push(e)}),this.deleteRepairImgIdList.forEach(function(e){L.deleteRepairImgIdList.push(e.name)}),L.repairModule=JSON.parse(l()(this.Form)),this.repairModuleList[this.indexs]=L,this.submitFlag&&this.saveForm()}},singleLook:function(e){var i=this;this.DialogVisible=!0,this.title="维修申请查看",Object(h.D)(e.processInstanceId).then(function(e){i.applyProcess=e;for(var t=!1,r=i.applyProcess.length-1;r>=0;r--)"EndEvent"===i.applyProcess[r].stepName&&(t=!0),"StartEvent"!==i.applyProcess[r].stepName&&"ExclusiveGateway"!==i.applyProcess[r].stepName&&"EndEvent"!==i.applyProcess[r].stepName||i.applyProcess.splice(r,1);i.applyStepActive=t?i.applyProcess.length:i.applyProcess.length-1}).catch(function(e){var t=e.result?e.result:"获取维修申请流程失败";i.$message({message:t,type:"error"})})},formatDate:function(e){var i=new Date(e),t="yyyy-MM-dd hh:mm:ss",r={"M+":i.getMonth()+1,"d+":i.getDate(),"h+":i.getHours(),"m+":i.getMinutes(),"s+":i.getSeconds(),"q+":Math.floor((i.getMonth()+3)/3),S:i.getMilliseconds()};for(var s in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(i.getFullYear()+"").substr(4-RegExp.$1.length))),r)new RegExp("("+s+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?r[s]:("00"+r[s]).substr((""+r[s]).length)));return t},beforeAvatarUpload:function(e){var i=e.size/1024/1024<200;return i||this.$message.error("上传图片大小不能超过 200MB!"),i},submitUpload:function(){this.$refs.upload.submit()},handleRemove:function(e,i){"success"===e.status&&(this.deleteRepairImgIdList.push({name:e.name,physics:e.physics}),this.uploadedImgNum--),this.uploadImgNum=i.length-this.uploadedImgNum,0==i.length&&(this.Form.picture="")},handleSuccess:function(e,i,t){this.uploadSuccessImgNum++;var r=i.name.split(".");"rar"==r[r.length-1]||"zip"==r[r.length-1]?this.Form.addressList.push({type:3,physicalAddress:e.imgList[0].imgPath,virtualAddress:e.imgList[0].imgUrl}):this.Form.addressList.push({type:1,physicalAddress:e.imgList[0].imgPath,virtualAddress:e.imgList[0].imgUrl}),this.uploadSuccessImgNum===this.uploadImgNum&&this.saveRepaireContent()},handleChange:function(e,i){"image"!==e.raw.type.split("/")[0]&&(e.url=""+p.a+p.f+"/images/compress.png"),this.uploadImgNum=i.length-this.uploadedImgNum,i.length>0&&(this.Form.picture="true")},handleExceed:function(e,i){this.$message.warning("最多只能上传五张照片！")},handleError:function(e,i,t){401===e.status&&(this.$store.dispatch("Logout",this.token),this.$router.push({path:"/login"}));e.result&&e.result;this.$message({message:e.message,type:"error"})},dialogOpen:function(){var e=this;this.$nextTick(function(){e.$refs.Form.clearValidate()})},clearForm:function(e){for(var i in e){var t=this.getDataType(e[i]);if("String"===t)e[i]="";else if("Array"===t)e[i]=[];else if("Object"===t){o()(e[i]).length>0?this.clearForm(e[i]):e[i]={}}else e[i]=null}},dialogClosed:function(){this.lookFlag=!0,this.editFlag=!1,this.dealFlag=!1,this.activeInfo=0,sessionStorage.removeItem("index"),this.flag=!1,this.clearForm(this.Form),this.fileList=[],this.oldFileList=[],this.detailFileList=[],this.uploadImgNum=0,this.uploadedImgNum=0,this.uploadSuccessImgNum=0,this.submitFlag=!1,this.treeShow=!1,this.checkedNodes={},this.houseIdList=[],this.houseNameList=[],this.expandIdList=[],this.houseNumber="",this.unitIdList=[],this.downloadList=[],this.deleteRepairImgIdList=[],this.repairModuleList=[],this.repairApplyId="",this.repairModuleId="","detail"!=this.operateType&&m.a.$emit("clearTreeSelectVal"),this.applyProcess=[],this.active=null,this.applyStatus="",this.indexs=0,this.applyStepActive=0},Closed:function(){this.clearForm(this.Form),this.fileList=[],this.oldFileList=[],this.detailFileList=[],this.uploadImgNum=0,this.uploadedImgNum=0,this.uploadSuccessImgNum=0,this.submitFlag=!1,this.treeShow=!1,this.checkedNodes={},this.houseIdList=[],this.houseNameList=[],this.expandIdList=[],this.houseNumber="",this.unitIdList=[],this.downloadList=[],this.deleteRepairImgIdList=[],this.repairModuleList=[],this.repairApplyId="",this.repairModuleId="",this.applyProcess=[],this.active=null,this.applyStatus="",this.indexs=0,this.applyStepActive=0},getImgUrl:function(e){return""+p.a+p.f+e+"?access_token="+this.token},preview:function(i){e(".img-preview-bigger").css("display","block"),e("#biggerImg").attr("src",p.a+p.f+i+"?access_token="+this.token)},closePreview:function(){e(".img-preview-bigger").css("display","none"),e("#biggerImg").css("width","auto")},loadImage:function(){var i=e(window).width(),t=e("#biggerImg");t.width()>=i&&t.css("width","80%")},getDataType:function(e){var i=!0,t=!1,r=void 0;try{for(var a,o=s()(["String","Object","Number","Array","Function"]);!(i=(a=o.next()).done);i=!0){var d=a.value;if(Object.prototype.toString.call(e)==="[object "+d+"]")return d}}catch(e){t=!0,r=e}finally{try{!i&&o.return&&o.return()}finally{if(t)throw r}}},loadNode:function(e,i){var t=this;if(0===e.level)Object(n.g)(null,0,null).then(function(e){return e.forEach(function(e){e.expand&&void 0!==e.expand||(e.leaf=!0)}),i(e)}).catch(function(e){t.$message({message:"树获取失败",type:"error"})}),Object(S.setTimeout)(function(){if(!t.Form.yardId||t.Form.buildId||t.Form.floorName||t.Form.houseId){if(t.Form.yardId&&t.Form.buildId&&!t.Form.floorName&&!t.Form.houseId){var e={level:2};e.id_yard=t.Form.yardId,e.id_build=t.Form.yardId+":"+t.Form.buildId,m.a.$emit("setTreeDefaultVal",e)}else if(t.Form.yardId&&t.Form.buildId&&t.Form.floorName&&!t.Form.houseId){var i={level:3};i.id_yard=t.Form.yardId,i.id_build=t.Form.yardId+":"+t.Form.buildId,i.buildId=t.Form.buildId,i.id_floor=t.Form.yardId+":"+t.Form.buildId+":"+t.Form.floorName,m.a.$emit("setTreeDefaultVal",i)}else if(t.Form.yardId&&t.Form.buildId&&t.Form.floorName&&t.Form.houseId){var r={level:4};r.id_yard=t.Form.yardId,r.id_build=t.Form.yardId+":"+t.Form.buildId,r.id_floor=t.Form.yardId+":"+t.Form.buildId+":"+t.Form.floorName,r.floorName=t.Form.floorName,r.id_house=t.Form.houseId,m.a.$emit("setTreeDefaultVal",r)}}else{var s={level:1};s.id_yard=t.Form.yardId,m.a.$emit("setTreeDefaultVal",s)}},1e3);else if(3===e.level){var r=sessionStorage.getItem("repairApply_buildId")-0;Object(n.g)(e.data.value,3,null,r).then(function(e){return e.forEach(function(e){e.expand&&void 0!==e.expand||(e.leaf=!0)}),i(e)}).catch(function(e){t.$message({message:"树获取失败",type:"error"})})}else Object(n.g)(e.data.value,e.data.type,null).then(function(e){return e.forEach(function(e){e.expand&&void 0!==e.expand||(e.leaf=!0)}),i(e)}).catch(function(e){t.$message({message:"树获取失败",type:"error"})})},handleCheckChange:function(e){e.type?(this.checkedNodes=e,this.Form.RepaireYard="true",this.currentLevel=e.type,1===e.type?this.Form.yardId=e.value:2===e.type?this.Form.buildId=e.value:3===e.type?this.Form.floorName=e.value:this.Form.houseId=e.value):this.Form.RepaireYard=""},handleNodeExpand:function(e,i){1===i.level?this.Form.yardId=e.value:2===i.level?(this.Form.buildId=e.value,sessionStorage.setItem("repairApply_buildId",e.value)):3===i.level&&(this.Form.floorName=e.value)},imgCheckboxChange:function(e,i){if(e)-1===this.downloadList.indexOf(i)&&this.downloadList.push(i);else{var t=this.downloadList.indexOf(i);this.downloadList.splice(t,1)}},downloadImg:function(){var e=this;this.downloadList.length>0?Object(h.i)(this.downloadList,20,this.repairApplyId).then(function(e){t("3UNf")(e,decodeURIComponent(sessionStorage.getItem("CADdownloadFileName")))}).catch(function(i){var t=i.result?i.result:"证件下载失败";e.$message({message:t,type:"error"})}):this.$message({message:"请先选中一个证件",type:"info"})},showInfoDetail:function(e){var i=this;if(this.houseNameList=[],this.houseIdList=[],this.expandIdList=[],this.detailFileList=[],this.downloadList=[],this.deleteRepairImgIdList=[],this.indexs=e,"detail"==this.operateType)sessionStorage.setItem("index",e),this.activeInfo=e,this.Form=this.repairModuleList[e].repairModule,this.Form.repairPartId=this.repairModuleList[e].repairModule.repairPartName,this.Form.RepairYard=this.repairModuleList[e].repairModule.positionStr,this.repairModuleList[e].addressList.forEach(function(e,t){var r=e.virtualAddress.split(".")[1];"rar"!==r&&"zip"!==r||(e.virtualAddress="/images/compress.png"),i.detailFileList.push(e)});else if("edit"==this.operateType){if(this.uploadImgNum=0,this.editFlag=!0,this.activeInfo=e,this.fileList=[],this.oldFileList=[],this.Form=this.repairModuleList[e].repairModule,this.Form.addressList=[],this.repairModuleList[e].addressImgList&&this.repairModuleList[e].addressImgList.length>0){var t=0;this.repairModuleList[e].addressImgList.forEach(function(e){t++;var r=e.virtualAddress.split(".")[1];"rar"!==r&&"zip"!==r||(e.virtualAddress="/images/compress.png");var s={name:e.repairImgId,url:p.a+p.f+e.virtualAddress+"?access_token="+i.token,physics:e.physicalAddress};i.fileList.push(s),i.oldFileList.push(s)}),this.uploadedImgNum=t,this.uploadSuccessImgNum=0}this.uploadedImgNum>0&&(this.Form.picture="true"),this.houseNameList=[];if(this.repairModuleList[e].repairModule.houseId){this.Form.yardId=this.repairModuleList[e].repairModule.yardId,this.Form.buildId=this.repairModuleList[e].repairModule.buildId,this.Form.floorName=this.repairModuleList[e].repairModule.floorName,this.Form.houseId=this.repairModuleList[e].repairModule.houseId,this.Form.positionStr=this.repairModuleList[e].repairModule.positionStr;var r=this.Form.positionStr.split("-"),s=r[r.length-1];this.houseNameList.push(s),this.houseIdList.push(this.repairModuleList[e].repairModule.houseId),this.expandIdList.push(this.repairModuleList[e].repairModule.yardId,this.repairModuleList[e].repairModule.buildId,this.repairModuleList[e].repairModule.buildId+":"+this.repairModuleList[e].repairModule.floorName),m.a.$emit("setTreeSelectVal",this.houseNameList,this.houseIdList,this.expandIdList)}else if(this.repairModuleList[e].repairModule.floorName)this.Form.yardId=this.repairModuleList[e].repairModule.yardId,this.Form.buildId=this.repairModuleList[e].repairModule.buildId,this.Form.floorName=this.repairModuleList[e].repairModule.floorName,this.houseNameList.push(this.repairModuleList[e].repairModule.floorName+"层"),this.houseIdList.push(this.repairModuleList[e].repairModule.yardId+":"+this.repairModuleList[e].repairModule.buildId+":"+this.repairModuleList[e].repairModule.floorName),this.expandIdList.push(this.repairModuleList[e].repairModule.yardId),this.expandIdList.push(this.repairModuleList[e].repairModule.buildId),this.expandIdList.push(this.repairModuleList[e].repairModule.floorName),m.a.$emit("setTreeSelectVal",this.houseNameList,this.houseIdList,this.expandIdList);else if(this.repairModuleList[e].repairModule.buildId){this.Form.yardId=this.repairModuleList[e].repairModule.yardId,this.Form.buildId=this.repairModuleList[e].repairModule.buildId,this.Form.positionStr=this.repairModuleList[e].repairModule.positionStr;var a=this.Form.positionStr.split("-"),o=a[a.length-1];this.houseNameList.push(o),this.houseIdList.push(this.repairModuleList[e].repairModule.yardId+":"+this.repairModuleList[e].repairModule.buildId),this.expandIdList.push(this.repairModuleList[e].repairModule.yardId),this.expandIdList.push(this.repairModuleList[e].repairModule.buildId),m.a.$emit("setTreeSelectVal",this.houseNameList,this.houseIdList,this.expandIdList)}else this.repairModuleList[e].repairModule.yardId&&(this.Form.yardId=this.repairModuleList[e].repairModule.yardId,this.Form.positionStr=this.repairModuleList[e].repairModule.positionStr,this.houseNameList.push(this.Form.positionStr),this.houseIdList.push(""+this.repairModuleList[e].repairModule.yardId),m.a.$emit("setTreeSelectVal",this.houseNameList,this.houseIdList,this.expandIdList));this.houseNameList.length>0&&(this.Form.RepaireYard="true")}else{if(this.uploadImgNum=0,this.uploadSuccessImgNum=0,this.editFlag=!0,this.activeInfo=e,this.fileList=[],this.oldFileList=[],this.Form=this.repairModuleList[e].repairModule,this.Form.addressList=[],this.repairModuleList[e].addressList&&this.repairModuleList[e].addressList.length>0){var d=0;this.repairModuleList[e].addressList.forEach(function(e){d++;var t=e.virtualAddress.split(".")[1];"rar"!==t&&"zip"!==t||(e.virtualAddress="/images/compress.png");var r={name:e.repairImgId,url:p.a+p.f+e.virtualAddress+"?access_token="+i.token,physics:e.physicalAddress};i.fileList.push(r),i.oldFileList.push(r)}),this.uploadedImgNum=d}this.uploadedImgNum>0&&(this.Form.picture="true"),this.houseNameList=[];if(this.repairModuleList[e].repairModule.houseId){this.Form.yardId=this.repairModuleList[e].repairModule.yardId,this.Form.buildId=this.repairModuleList[e].repairModule.buildId,this.Form.floorName=this.repairModuleList[e].repairModule.floorName,this.Form.houseId=this.repairModuleList[e].repairModule.houseId,this.Form.positionStr=this.repairModuleList[e].repairModule.positionStr;var l=this.Form.positionStr.split("-"),u=l[l.length-1];this.houseNameList.push(u),this.houseIdList.push(this.repairModuleList[e].repairModule.houseId),this.expandIdList.push(this.repairModuleList[e].repairModule.yardId,this.repairModuleList[e].repairModule.buildId,this.repairModuleList[e].repairModule.buildId+":"+this.repairModuleList[e].repairModule.floorName),m.a.$emit("setTreeSelectVal",this.houseNameList,this.houseIdList,this.expandIdList)}else if(this.repairModuleList[e].repairModule.floorName)this.Form.yardId=this.repairModuleList[e].repairModule.yardId,this.Form.buildId=this.repairModuleList[e].repairModule.buildId,this.Form.floorName=this.repairModuleList[e].repairModule.floorName,this.houseNameList.push(this.repairModuleList[e].repairModule.floorName+"层"),this.houseIdList.push(this.repairModuleList[e].repairModule.yardId+":"+this.repairModuleList[e].repairModule.buildId+":"+this.repairModuleList[e].repairModule.floorName),this.expandIdList.push(this.repairModuleList[e].repairModule.yardId),this.expandIdList.push(this.repairModuleList[e].repairModule.buildId),this.expandIdList.push(this.repairModuleList[e].repairModule.floorName),m.a.$emit("setTreeSelectVal",this.houseNameList,this.houseIdList,this.expandIdList);else if(this.repairModuleList[e].repairModule.buildId){this.Form.yardId=this.repairModuleList[e].repairModule.yardId,this.Form.buildId=this.repairModuleList[e].repairModule.buildId,this.Form.positionStr=this.repairModuleList[e].repairModule.positionStr;var h=this.Form.positionStr.split("-"),n=h[h.length-1];this.houseNameList.push(n),this.houseIdList.push(this.repairModuleList[e].repairModule.yardId+":"+this.repairModuleList[e].repairModule.buildId),this.expandIdList.push(this.repairModuleList[e].repairModule.yardId),this.expandIdList.push(this.repairModuleList[e].repairModule.buildId),m.a.$emit("setTreeSelectVal",this.houseNameList,this.houseIdList,this.expandIdList)}else this.repairModuleList[e].repairModule.yardId&&(this.Form.yardId=this.repairModuleList[e].repairModule.yardId,this.Form.positionStr=this.repairModuleList[e].repairModule.positionStr,this.houseNameList.push(this.Form.positionStr),this.houseIdList.push(""+this.repairModuleList[e].repairModule.yardId),m.a.$emit("setTreeSelectVal",this.houseNameList,this.houseIdList,this.expandIdList));this.houseNameList.length>0&&(this.Form.RepaireYard="true")}},handleCommand:function(e){var i=this;if(this.checkedNodes={},this.indexs=e,"detail"==this.operateType)this.detailFileList=[],this.Form.RepairYard=this.repairModuleList[e].repairModule.positionStr,this.Form.repairModuleTarget=this.repairModuleList[e].repairModule.repairModuleTarget,this.Form.repairPartId=this.repairModuleList[e].repairModule.repairPartName,this.Form.repairModulePosition=this.repairModuleList[e].repairModule.repairModulePosition,this.Form.repairModuleArea=this.repairModuleList[e].repairModule.repairModuleArea,this.repairModuleList[e].addressList.length>0&&this.repairModuleList[e].addressList.forEach(function(e,t){var r=e.virtualAddress.split(".")[1];"rar"!==r&&"zip"!==r||(e.virtualAddress="/images/compress.png"),i.detailFileList.push(e)});else{if(this.flag||this.addRepaireContent("Form"),Object(S.setTimeout)(function(){i.flag=!0},200),this.detailFileList=[],this.Form.repairPartId=this.repairModuleList[e].repairModule.repairPartId,this.Form.repairModuleTarget=this.repairModuleList[e].repairModule.repairModuleTarget,this.Form.repairModulePosition=this.repairModuleList[e].repairModule.repairModulePosition,this.Form.repairModuleArea=this.repairModuleList[e].repairModule.repairModuleArea,this.fileList=[],this.oldFileList=[],this.repairModuleList[e].addressList&&this.repairModuleList[e].addressList.length>0){var t=0;this.repairModuleList[e].addressList.forEach(function(e){t++;var r=e.virtualAddress.split(".")[1];"rar"!==r&&"zip"!==r||(e.virtualAddress="/images/compress.png");var s={name:e.repairImgId,url:p.a+p.f+e.virtualAddress+"?access_token="+i.token};i.fileList.push(s),i.oldFileList.push(s)}),this.uploadedImgNum=t,this.uploadedImgNum=this.repairModuleList[e].addressList.length}this.houseNameList=[],this.repairModuleList[e].repairModule.houseId?(this.Form.yardId=this.repairModuleList[e].repairModule.yardId,this.Form.buildId=this.repairModuleList[e].repairModule.buildId,this.Form.floorName=this.repairModuleList[e].repairModule.floorName,this.Form.houseId=this.repairModuleList[e].repairModule.houseId,this.houseNameList.push(this.repairModuleList[e].repairModule.houseNumber),this.houseIdList.push(this.repairModuleList[e].repairModule.yardId+":"+this.repairModuleList[e].repairModule.buildId+":"+this.repairModuleList[e].repairModule.floorName+":"+this.repairModuleList[e].repairModule.houseId),this.expandIdList.push(this.repairModuleList[e].repairModule.yardId,this.repairModuleList[e].repairModule.buildId,this.repairModuleList[e].repairModule.buildId+":"+this.repairModuleList[e].repairModule.floorName),m.a.$emit("setTreeSelectVal",this.houseNameList,this.houseIdList,this.expandIdList)):this.repairModuleList[e].repairModule.floorName?(this.Form.buildId=this.repairModuleList[e].repairModule.buildId,this.Form.floorName=this.repairModuleList[e].repairModule.floorName,this.houseNameList.push(this.repairModuleList[e].repairModule.repairModule.floorName),this.houseIdList.push(this.repairModuleList[e].repairModule.buildId+":"+this.repairModuleList[e].repairModule.floorName),this.expandIdList.push(this.repairModuleList[e].repairModule.buildId),m.a.$emit("setTreeSelectVal",this.houseNameList,this.houseIdList,this.expandIdList)):this.repairModuleList[e].repairModule.buildId?(this.Form.buildId=this.repairModuleList[e].repairModule.buildId,this.houseNameList.push(this.repairModuleList[e].repairModule.buildName),this.houseIdList.push(""+this.repairModuleList[e].repairModule.buildId),this.expandIdList.push(this.repairModuleList[e].repairModule.buildId),m.a.$emit("setTreeSelectVal",this.houseNameList,this.houseIdList,this.expandIdList)):this.repairModuleList[e].repairModule.yardId&&(this.Form.yardId=this.repairModuleList[e].repairModule.yardId,this.houseNameList.push(this.repairModuleList[e].repairModule.yardName),this.houseIdList.push(""+this.repairModuleList[e].repairModule.yardId),m.a.$emit("setTreeSelectVal",this.houseNameList,this.houseIdList))}},limitFloat:function(e,i){this.Form[e]=this.Form[e].replace(/[^\d.]/g,"").replace(/\.{2,}/g,".").replace(".","$#$").replace(/\./g,"").replace("$#$",".").replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3").replace(/^\./g,""),i&&""!==this.Form[e]&&(this.Form[e]=(this.Form[e]-0).toFixed(2))},limitInt:function(e){this.Form[e]=this.Form[e].replace(/[^0-9]/g,"")}},mounted:function(){var i=this;(this.getList(),this.$store.state.repaire.repaireArray.length)&&(this.dialogVisible=!0,this.title="新增维修信息",this.treeShow=!0,this.getUnit(),this.getRepairPart(),this.$store.state.repaire.repaireArray.forEach(function(e){var t={repairModule:{},addressList:[],deleteRepairImgIdList:[]};t.repairModule.houseId=e.houseId?e.houseId:"",t.repairModule.floorName=e.floorName?e.floorName:"",t.repairModule.buildId=e.buildId?e.buildId:"",t.repairModule.yardId=e.yardId?e.yardId:"",t.repairModule.positionStr=e.position,t.repairModule.repairPartId=e.repairPart;var r=e.position.split("-");5==r.length?(t.repairModule.yardName=r[0],t.repairModule.buildName=r[1],t.repairModule.houseNumber=r[4]):4==r.length?-1!=r.indexOf("")?(t.repairModule.yardName=r[0],t.repairModule.buildName=r[1]):(t.repairModule.yardName=r[0],t.repairModule.buildName=r[1],t.repairModule.houseNumber=r[3]):3==r.length?(t.repairModule.yardName=r[0],t.repairModule.buildName=r[1]):2==r.length?(t.repairModule.yardName=r[0],t.repairModule.buildName=r[1]):t.repairModule.yardName=r[0],i.repairModuleList.push(t)}),this.dealFlag=!0,this.$nextTick(function(){i.showForm(i.indexs)}),this.$store.commit("getRepaireList",[]));Object(S.setTimeout)(function(){var t=e("#mainDiv").height(),r=e("#queryBox").outerHeight(!0),s=e("#operateBox").height();i.tableHeight=t-r-s},1),this.token=sessionStorage.getItem("TOKEN"),this.token&&(this.postHeaders.Authorization="Bearer "+this.token)}}}).call(i,t("7t+N"))}});
//# sourceMappingURL=38.6be3a5660750b446e506.js.map