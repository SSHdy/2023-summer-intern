webpackJsonp([16],{"5sxt":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAfCAYAAAAIjIbwAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoxRDA0MThGREM4OTMxMUU5ODhCM0ZEQTU4NUQzMThCQyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoxRDA0MThGRUM4OTMxMUU5ODhCM0ZEQTU4NUQzMThCQyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjFEMDQxOEZCQzg5MzExRTk4OEIzRkRBNTg1RDMxOEJDIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjFEMDQxOEZDQzg5MzExRTk4OEIzRkRBNTg1RDMxOEJDIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+un2kIAAAAblJREFUeNpizGM4fZiBgUGfgXrgFguQkAZiXioaKsMEJD4wUBe8Z2KgARg1lDzAzsPEUH9fl6Hqmg6GHAu5hubsU2cQUmBn+Pb+L3VcGjZDnkHOlJvh/z8Ghm7Dq5QbapEswmCdLgpmz/C6xfDu4S/ChhYe1wSHlbQBF2ZWMeJiiJyjAGZvqX7KcGPnJ+IiipOfGRxWpee0GJSseRDiAswMufvVwexL698z7G57Tnzst2tfAbuAkZGBIf+IBoOcCTfcBxx8zAxv7v5kmBt0l7Qk9f8/A8N0j1sMF1a/B/PzDqkDsQaDuAYHOGImO9wkP53OD7vLcGLeGwZWTiYGZVtIMMz0vs3w4ckvgobiTafLkx8w/P72j8EoQohhe+Mzhus7PhKVQhiBhfQ5IG1IxVx6Y7SUGmaGrgFiUB6tpJahjUAcCqrPgbgDyv5PiaHhQNyAxdW6QHyXVEPvQTWuwiEPKplB9cg2Yg3dAdVwhYAvfgCxNxD3YDMUuYToA2JPIP5ObExP/G9SCqQSkIR+gww1hnKSgLiYnCQENHghkDIF4p+gYAMZuguIA0GlHSVpE2jwGWiwLQQIMADwjnars0t70QAAAABJRU5ErkJggg=="},IQiS:function(e,t){},clv2:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAAAXCAYAAAD0v0pBAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowOTkyOEExNTM1ODIxMUU5QjE3QTk3OTNGMDFDMzI2NCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDowOTkyOEExNjM1ODIxMUU5QjE3QTk3OTNGMDFDMzI2NCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjA5OTI4QTEzMzU4MjExRTlCMTdBOTc5M0YwMUMzMjY0IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjA5OTI4QTE0MzU4MjExRTlCMTdBOTc5M0YwMUMzMjY0Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+GU+OcwAAA2lJREFUeNrsmV1Ik1EYx8/ebWpDTdSQ7EIQP8rAsUjRm4gsUCMtIlIwAu2qECKjroMoIgUvoptw0Adp1o1FVHiRdSWBiYJUClpdmJJNc35tc+86//Uc96avOiHlXJw/PLzb3nPOxu9/nuec98wyPuFhUFpdYx+/5DOlrVD/eMtlJ15oPCw8rHabtVVx2RoRayvYa2SC/XhBbge/Lio8m65FYm0He5EBsXfOlc+nJjreKT6bKzAGazAXGcDIhJhyV/YLWX+4KzN9U9tvlYhxDDEPlx+dRxCpcbOmpDfJETciI/y31+tYa8PpqNo/u1Idbi+bCWALxlTqwVyHASEeAR7zNk2bPezMbJfNgN7hUfaqZ5CV7stZ1wTcL3Fmhdujn0wCWzAGa2IeEgbAkQUeM7fPHOmMj4sZk82E6qYn7E3v0Jom4HPcf/1xMNxeJoEp2IIxsV4UBjBKBx+PWUes3VvmynogY/2samxj7we+mpog4OO+bPAhMAVbMCbWQbEGMEMZmuPhba4t7UxJcAzJaELljYdLJrjrT66Aj/uyCSzBFGyJcYCYLxkgsgCpMcvrlLfukOueaCSrCSeK8ljntVqp4YMhWIIpzf4FMfuXG6CTM2g03VBR3JOTntIl67YUsLu/fGcF2btkhs/AECzBlNgGiPXf/b84CzIYEscjmcfO/m/jmZW32u7O+QLJshpRUbiHPf/wScrfxmu+p+Nq1fn8jLRh/vYHDw9lgG6WASIL/CILeMex+rLCJosl0kE2yQofzMAODA2z32+Eb2aAcS1Ap9+XjhX38Kc3tzpE2PATrxvswJBY/lP71zIgRE5hvzqFAdwXKjsO5GW0K6zRCazAjOBPEUu/2aZGW2UMnfaqcG4SAz1tOPW4Yn9ui2axBBRic4ENGIEVwZ8khr7lpWe1RXi5OTg0SuSxgyLpflff7uaX3TWjHu9ehTyi9OSEgYtHix6dPej8TLP+J8W0We2PxgAIfxrg2HQ7nid4pJIh23jYGJ3oKS0d58wT8AkevygLfGa1X8i2zsBBQykSpQlfFE/GaMqEMHxRsmdoq2ksPcG1Otui+AKdVnDhMgZNMGSBUmT2ew1bzlXr/kYNCBkyQVy9tD6oDIhkgJ8mqo9FzvvZ/zDAWI50w3OCVcFfMUkFn6jP0P4IMABiMmGhHV1kxgAAAABJRU5ErkJggg=="},d2OP:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("fZjL"),n=i.n(s),a=i("d7EF"),o=i.n(a),r=i("W3Iv"),u=i.n(r),l=i("BO1k"),d=i.n(l),h=i("mvHQ"),c=i.n(h),g=i("u3Mf"),b=i("Oizb"),v=i("PVpU"),f=i("yzMb"),m=i("uSev"),I=i("fYBn"),p=i("02tb"),L=i("6Vw2"),A=i("7t+N"),U=i("tsU9").fabric,C=(i("gApy"),{components:{cancelBtn:I.a,confirmBtn:p.a,saveBtn:L.a,tableComponent:m.a},data:function(){return{PRO_TYPE:g.e,canvas:{},canvasHeight:0,canvasWidth:0,houseTypeColor:[{id:1,color:"#21b124"},{id:2,color:"#f4e83b"},{id:3,color:"#008aff"},{id:4,color:"#12fff1"},{id:5,color:"#ff01fd"},{id:6,color:"#fe8200"}],dialogTitle:"",dialogVisible:!1,contextMenuItems:{distribute:{name:"模拟分配",icon:"edit"},revert:{name:"撤销"}},contextMenuItems_2:{distribute:{name:"模拟分配",icon:"edit"}},Form:{configurePlanDataId:null,houseId:null,houseNumber:null,originalUnitNameList:"",newUnitNameList:"",houseUseArea:"",housetypeName:"",isIdle:null,originalUnitList:[],oldConfUnitList:[],newConfUnitList:[],selectedUnitIdList:[],isUse:null,applyStatus:null,handleWay:null,isIdleText:""},originalHouseList:[],editHouseInfo:[],saveFormList:[],distributableList:[],selectedDistributeList:[],distributeChangeList:[],oldDistributeChangeList:[],distributeChangeObj:{},unitOptions:[],revertSaveList:[],rules:{selectedUnitIdList:[{required:!0,message:"分配单位不能为空",trigger:"change"}]},totalRoomArea:null,totalRoomNum:null,configureId:null,planId:null,isHandle:null,currentUseState:!1,oldIdle:null,distributeFlag:!1,isBatchDistribute:!1,expandChangeDetail:!1,showChangeDetail:!1,tableHeight:0,tableHeaderCellStyle:{padding:"6px 0",color:"#333333"},tableCellStyle:{padding:"6px 0","background-color":"#f3f3f3"},canDistributeOrSave:!0,notDistributeReason:"",allNavList:null}},methods:{changeBoxCollapse:function(){var e=this;A(".change-detail-dialog").animate({height:"4px"},function(){e.expandChangeDetail=!1})},changeBoxExpand:function(e){var t=this;A(".change-detail-dialog").animate({height:"40%"},function(){t.expandChangeDetail=!0;var e=A(".change-detail-content").height();t.tableHeight=e})},idleRadioChange:function(e){if(0===this.Form.isUse&&0===e)return this.Form.isIdle=1,void this.$message({message:"该房间没有原使用单位，使用情况不能更改为闲置！",type:"warning"})},distributeStart:function(){this.distributeFlag=!0,this.Form.isIdle=1},distributeEnd:function(){this.distributeFlag=!1,this.Form.isIdle=null,this.selectedUnitIdList=[]},init:function(){var e=this;this.canvas&&this.canvas.clear&&this.canvas.clear(),this.canvas=new U.Canvas("c"),U.ActiveSelection.prototype.hasControls=U.ActiveSelection.prototype.hasBorders=!1,U.Object.prototype.originX="left",U.Object.prototype.originY="top",U.Object.prototype.transparentCorners=!1,U.Object.prototype.borderColor="red",U.Object.prototype.cornerColor="green",U.Object.prototype.cornerSize=6,U.Object.prototype.borderScaleFactor=2,U.Object.prototype.transparentCorners=U.Object.prototype.hasControls=U.Object.prototype.hasRotatingPoint=!1,U.Object.prototype.lockMovementX=U.Object.prototype.lockMovementY=!0,window.canvas=this.canvas,this.setZoom(),window.onresize=function(){e.setZoom()},A.contextMenu({selector:".upper-canvas",trigger:"none",build:function(e,t){return t.data("runCallbackThingie")()}})},setZoom:function(){var e=A(this.canvas.wrapperEl).parent();this.canvasWidth=e.width(),this.canvasHeight=e.height(),window.zoom=1,this.canvas.setZoom(1),this.canvas.setWidth(this.canvasWidth),this.canvas.setHeight(this.canvasHeight),this.canvas.renderAll()},showContextMenu:function(e){if(3===e.which){var t=A(e.toElement),i=this.canvas.getObjects();if(i&&i.length>0)for(var s=0;s<i.length;s++){var n=i[s];if(this.canvas.containsPoint(e,n)){if("group"!==n.type)return!1;this.canvas.discardActiveObject(),this.canvas.setActiveObject(n),this.canvas.renderAll();for(var a=!0,o=0;o<this.editHouseInfo.length;o++)if(this.editHouseInfo[o].houseId===n.uuid){a=!1,this.currentUseState=0===this.editHouseInfo[o].isIdle||1===this.editHouseInfo[o].isIdle,t.data("runCallbackThingie",this.createSomeMenu);var r={x:e.clientX,y:e.clientY};t.contextMenu(r)}if(a)for(var u=0;u<this.originalHouseList.length;u++)if(this.originalHouseList[u].houseId===n.uuid){this.currentUseState=0===this.originalHouseList[u].isIdle||1===this.originalHouseList[u].isIdle,t.data("runCallbackThingie",this.createSomeMenu);var l={x:e.clientX,y:e.clientY};t.contextMenu(l)}return!1}}}},createSomeMenu:function(){var e=this.currentUseState?this.contextMenuItems:this.contextMenuItems_2;return{callback:this.contextMenuClick,items:e}},contextMenuClick:function(e,t){var i=this;if("distribute"===t){if(!this.canDistributeOrSave)return this.$message({message:"该楼座已"+this.notDistributeReason+", 不能进行分配",type:"warning"}),!1;for(var s=this.canvas.getActiveObject(),n=!1,a=0;a<this.editHouseInfo.length;a++)if(this.editHouseInfo[a].houseId===s.uuid){this.Form=JSON.parse(c()(this.editHouseInfo[a])),n=!0;break}for(var o=null,r=0;r<this.originalHouseList.length;r++)if(this.originalHouseList[r].houseId===s.uuid){var u=this.originalHouseList[r];this.oldIdle=0===u.isIdle||1===u.isIdle?u.isIdle:null,o=JSON.parse(c()(u))}n||(this.Form=JSON.parse(c()(o))),this.dialogVisible=!0}else"revert"===t&&this.$confirm("此操作将永久删除房间配置方案数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){for(var e=i.canvas.getActiveObject(),t=null,s=0;s<i.originalHouseList.length;s++)if(i.originalHouseList[s].houseId===e.uuid){t=JSON.parse(c()(i.originalHouseList[s]));break}for(var n=0;n<i.saveFormList.length;n++)if(i.saveFormList[n].houseId===e.uuid){i.saveFormList.splice(n,1);break}for(var a=0;a<i.distributableList.length;a++)if(i.distributableList[a].houseId===e.uuid){i.distributableList[a].isIdle=null,i.distributableList[a].selectedUnitIdList=[];break}for(var o=!0,r=0;r<i.editHouseInfo.length;r++)if(i.editHouseInfo[r].houseId===e.uuid){i.editHouseInfo[r].isIdle=null,i.editHouseInfo[r].selectedUnitIdList=[],o=!1;break}if(o){var u=JSON.parse(c()(t));u.selectedUnitIdList=[],u.isIdle=null,i.editHouseInfo.push(u)}if(t.configurePlanDataId&&i.revertSaveList.push(t.configurePlanDataId),void 0===i.distributeChangeObj[t.houseId]&&(i.distributeChangeObj[t.houseId]={},i.distributeChangeObj[t.houseId].remove=[],i.distributeChangeObj[t.houseId].add=[]),0===t.isIdle){var l={unitNames:"闲置"};if(l.useArea="-"+t.houseUseArea-0,l.houseNumber=-1,i.distributeChangeObj[t.houseId].remove=[],i.distributeChangeObj[t.houseId].remove.push(l),t.rent){var d={unitNames:"出租"};d.useArea=""+t.houseUseArea-0,d.houseNumber=1,i.distributeChangeObj[t.houseId].add=[],i.distributeChangeObj[t.houseId].add.push(d)}else{var h=[];t.originalUnitList.forEach(function(e){h.push(e.originalUnitName)});var g={};g.unitNames=h.join(","),g.useArea=""+t.houseUseArea-0,g.houseNumber=1,i.distributeChangeObj[t.houseId].add=[],i.distributeChangeObj[t.houseId].add.push(g)}}else if(1===t.isIdle){var b=[];t.newConfUnitList.length>0&&t.newConfUnitList.forEach(function(e){b.push(e.newUnitName)});var v={};if(v.unitNames=b.join(","),v.useArea="-"+t.houseUseArea-0,v.houseNumber=-1,i.distributeChangeObj[t.houseId].remove=[],i.distributeChangeObj[t.houseId].remove.push(v),t.rent){var f={unitNames:"出租"};f.useArea=""+t.houseUseArea-0,f.houseNumber=1,i.distributeChangeObj[t.houseId].add=[],i.distributeChangeObj[t.houseId].add.push(f)}else if(t.originalUnitList.length>0){var m=[];t.originalUnitList.forEach(function(e){m.push(e.originalUnitName)});var I={};I.unitNames=m.join(","),I.useArea=""+t.houseUseArea-0,I.houseNumber=1,i.distributeChangeObj[t.houseId].add=[],i.distributeChangeObj[t.houseId].add.push(I)}else{var p={unitNames:"闲置"};p.useArea=""+t.houseUseArea-0,p.houseNumber=1,i.distributeChangeObj[t.houseId].add=[],i.distributeChangeObj[t.houseId].add.push(p)}}else i.distributeChangeObj[t.houseId].add=[],i.distributeChangeObj[t.houseId].remove=[];i.getChangeData();var L=e.getObjects("image");L.length>0&&L.forEach(function(t){e.remove(t),i.canvas.requestRenderAll()}),i.$message({message:"撤销成功",type:"success"})}).catch(function(){i.$message({type:"info",message:"已取消撤销操作"})})},batchDistribution:function(){var e=this,t=sessionStorage.getItem("buildId"),i=sessionStorage.getItem("floorName");if(!t||!i)return this.$message({message:"请先选择楼层",type:"warning"}),!1;if(!this.canDistributeOrSave)return this.$message({message:"该楼座已"+this.notDistributeReason+", 不能进行分配",type:"warning"}),!1;var s=[],n=canvas.getActiveObject();if(!n)return this.$message({message:"请先选择要分配的房间！",type:"warning"}),!1;if("group"===n.type&&"room"===n.typeName)s.push(n);else if("activeSelection"===n.type)for(var a=0;a<n._objects.length;a++){var o=n._objects[a];"group"===o.type&&"room"===o.typeName&&s.push(o)}this.selectedDistributeList=[];for(var r=0;r<s.length;r++)for(var u=0;u<this.distributableList.length;u++)if(this.distributableList[u].houseId===s[r].uuid){this.selectedDistributeList.push(this.distributableList[u]);break}this.totalRoomArea=0,this.selectedDistributeList.forEach(function(t){if(t.houseUseArea&&(e.totalRoomArea+=t.houseUseArea),t.isIdleText=1===t.isIdle||0===t.isIdle?"已调整":"未调整",t.selectedUnitIdList.length>0){var i=[];t.selectedUnitIdList=t.selectedUnitIdList.sort(function(e,t){return e-t}),t.selectedUnitIdList.forEach(function(t){for(var s=0;s<e.unitOptions.length;s++)if(t===e.unitOptions[s].unitId){i.push(e.unitOptions[s].unitName);break}}),t.newUnitNameList=i.join(",")}else t.newUnitNameList="暂无"}),this.totalRoomArea=this.totalRoomArea.toFixed(2),this.totalRoomNum=this.selectedDistributeList.length,this.isBatchDistribute=!0,this.dialogVisible=!0},batchRevert:function(){var e=this,t=sessionStorage.getItem("buildId"),i=sessionStorage.getItem("floorName");if(!t||!i)return this.$message({message:"请先选择楼层",type:"warning"}),!1;this.$confirm("此操作将永久批量删除整层楼的房间配置方案数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.distributableList.forEach(function(t){t.isIdle=null,t.selectedUnitIdList=[];for(var i=null,s=0;s<e.originalHouseList.length;s++)if(e.originalHouseList[s].houseId===t.houseId){i=JSON.parse(c()(e.originalHouseList[s]));break}for(var n=0;n<e.saveFormList.length;n++)if(e.saveFormList[n].houseId===t.houseId){e.saveFormList.splice(n,1);break}for(var a=!0,o=0;o<e.editHouseInfo.length;o++)if(e.editHouseInfo[o].houseId===t.houseId){e.editHouseInfo[o].isIdle=null,e.editHouseInfo[o].selectedUnitIdList=[],a=!1;break}if(a){var r=JSON.parse(c()(i));r.selectedUnitIdList=[],r.isIdle=null,e.editHouseInfo.push(r)}if(i.configurePlanDataId&&-1===e.revertSaveList.indexOf(i.configurePlanDataId)&&e.revertSaveList.push(i.configurePlanDataId),void 0===e.distributeChangeObj[i.houseId]&&(e.distributeChangeObj[i.houseId]={},e.distributeChangeObj[i.houseId].remove=[],e.distributeChangeObj[i.houseId].add=[]),0===i.isIdle){var u={unitNames:"闲置"};if(u.useArea="-"+i.houseUseArea-0,u.houseNumber=-1,e.distributeChangeObj[i.houseId].remove=[],e.distributeChangeObj[i.houseId].remove.push(u),i.rent){var l={unitNames:"出租"};l.useArea=""+i.houseUseArea-0,l.houseNumber=1,e.distributeChangeObj[i.houseId].add=[],e.distributeChangeObj[i.houseId].add.push(l)}else{var d=[];i.originalUnitList.forEach(function(e){d.push(e.originalUnitName)});var h={};h.unitNames=d.join(","),h.useArea=""+i.houseUseArea-0,h.houseNumber=1,e.distributeChangeObj[i.houseId].add=[],e.distributeChangeObj[i.houseId].add.push(h)}}else if(1===i.isIdle){var g=[];i.newConfUnitList.length>0&&i.newConfUnitList.forEach(function(e){g.push(e.newUnitName)});var b={};if(b.unitNames=g.join(","),b.useArea="-"+i.houseUseArea-0,b.houseNumber=-1,e.distributeChangeObj[i.houseId].remove=[],e.distributeChangeObj[i.houseId].remove.push(b),i.rent){var v={unitNames:"出租"};v.useArea=""+i.houseUseArea-0,v.houseNumber=1,e.distributeChangeObj[i.houseId].add=[],e.distributeChangeObj[i.houseId].add.push(v)}else if(i.originalUnitList.length>0){var f=[];i.originalUnitList.forEach(function(e){f.push(e.originalUnitName)});var m={};m.unitNames=f.join(","),m.useArea=""+i.houseUseArea-0,m.houseNumber=1,e.distributeChangeObj[i.houseId].add=[],e.distributeChangeObj[i.houseId].add.push(m)}else{var I={unitNames:"闲置"};I.useArea=""+i.houseUseArea-0,I.houseNumber=1,e.distributeChangeObj[i.houseId].add=[],e.distributeChangeObj[i.houseId].add.push(I)}}else e.distributeChangeObj[i.houseId].add=[],e.distributeChangeObj[i.houseId].remove=[]}),e.getChangeData();var t=e.canvas.getObjects("group");t.length>0&&t.forEach(function(t){if("room"===t.typeName){var i=t.getObjects("image");i.length>0&&i.forEach(function(i){t.remove(i),e.canvas.requestRenderAll()})}}),e.$message({message:"撤销成功",type:"success"})}).catch(function(){e.$message({type:"info",message:"已取消撤销操作"})})},batchDistributeDataSubmit:function(){var e=this;this.selectedDistributeList.length>0&&(this.selectedDistributeList.forEach(function(t){e.Form.houseId=t.houseId,e.Form.configurePlanDataId=t.configurePlanDataId?t.configurePlanDataId:null,e.Form.newConfUnitList=t.newConfUnitList,e.Form.oldConfUnitList=t.oldConfUnitList,e.Form.originalUnitList=t.originalUnitList;for(var s=null,n=null,a=null,o=e.Form.isIdle,r=0;r<e.originalHouseList.length;r++)if(e.Form.houseId===e.originalHouseList[r].houseId){s=e.originalHouseList[r],n=e.originalHouseList[r].newConfUnitList,a=e.originalHouseList[r].isIdle;break}if(void 0===e.distributeChangeObj[s.houseId]&&(e.distributeChangeObj[s.houseId]={},e.distributeChangeObj[s.houseId].remove=[],e.distributeChangeObj[s.houseId].add=[]),0!==a&&1!==a){if(0===o){if(s.rent){var u={unitNames:"出租"};u.useArea="-"+s.houseUseArea-0,u.houseNumber=-1,e.distributeChangeObj[s.houseId].remove=[],e.distributeChangeObj[s.houseId].remove.push(u)}else{var l=[];s.originalUnitList.forEach(function(e){l.push(e.originalUnitName)});var d={};d.unitNames=l.join(","),d.useArea="-"+s.houseUseArea-0,d.houseNumber=-1,e.distributeChangeObj[s.houseId].remove=[],e.distributeChangeObj[s.houseId].remove.push(d)}var h={unitNames:"闲置"};h.useArea=""+s.houseUseArea-0,h.houseNumber=1,e.distributeChangeObj[s.houseId].add=[],e.distributeChangeObj[s.houseId].add.push(h)}else if(1===o){if(s.rent){var g={unitNames:"出租"};g.useArea="-"+s.houseUseArea-0,g.houseNumber=-1,e.distributeChangeObj[s.houseId].remove=[],e.distributeChangeObj[s.houseId].remove.push(g)}else if(s.originalUnitList.length>0){var b=[];s.originalUnitList.forEach(function(e){b.push(e.originalUnitName)});var v={};v.unitNames=b.join(","),v.useArea="-"+s.houseUseArea-0,v.houseNumber=-1,e.distributeChangeObj[s.houseId].remove=[],e.distributeChangeObj[s.houseId].remove.push(v)}else{var f={unitNames:"闲置"};f.useArea="-"+s.houseUseArea-0,f.houseNumber=-1,e.distributeChangeObj[s.houseId].remove=[],e.distributeChangeObj[s.houseId].remove.push(f)}var m=[],I=e.Form.selectedUnitIdList;(I=I.sort(function(e,t){return e-t})).forEach(function(t){for(var i=0;i<e.unitOptions.length;i++)if(t===e.unitOptions[i].unitId){m.push(e.unitOptions[i].unitName);break}});var p={};p.unitNames=m.join(","),p.useArea=""+s.houseUseArea-0,p.houseNumber=1,e.distributeChangeObj[s.houseId].add=[],e.distributeChangeObj[s.houseId].add.push(p)}}else if(0===a){if(1===o){var L={unitNames:"闲置"};L.useArea="-"+s.houseUseArea-0,L.houseNumber=-1,e.distributeChangeObj[s.houseId].remove=[],e.distributeChangeObj[s.houseId].remove.push(L);var A=[],C=e.Form.selectedUnitIdList;(C=C.sort(function(e,t){return e-t})).forEach(function(t){for(var i=0;i<e.unitOptions.length;i++)if(t===e.unitOptions[i].unitId){A.push(e.unitOptions[i].unitName);break}});var N={};N.unitNames=A.join(","),N.useArea=""+s.houseUseArea-0,N.houseNumber=1,e.distributeChangeObj[s.houseId].add=[],e.distributeChangeObj[s.houseId].add.push(N)}}else if(1===a)if(0===o){var O=[];n.length>0&&n.forEach(function(e){O.push(e.newUnitName)});var j={};j.unitNames=O.join(","),j.useArea="-"+s.houseUseArea-0,j.houseNumber=-1,e.distributeChangeObj[s.houseId].remove=[],e.distributeChangeObj[s.houseId].remove.push(j);var w={unitNames:"闲置"};w.useArea=""+s.houseUseArea-0,w.houseNumber=1,e.distributeChangeObj[s.houseId].add=[],e.distributeChangeObj[s.houseId].add.push(w)}else if(1===o){var D=[];n.length>0&&n.forEach(function(e){D.push(e.newUnitName)});var S={};S.unitNames=D.join(","),S.useArea="-"+s.houseUseArea-0,S.houseNumber=-1,e.distributeChangeObj[s.houseId].remove=[],e.distributeChangeObj[s.houseId].remove.push(S);var y=[],E=e.Form.selectedUnitIdList;(E=E.sort(function(e,t){return e-t})).forEach(function(t){for(var i=0;i<e.unitOptions.length;i++)if(t===e.unitOptions[i].unitId){y.push(e.unitOptions[i].unitName);break}});var x={};x.unitNames=y.join(","),x.useArea=""+s.houseUseArea-0,x.houseNumber=1,e.distributeChangeObj[s.houseId].add=[],e.distributeChangeObj[s.houseId].add.push(x)}var M=sessionStorage.getItem("yardId"),F=sessionStorage.getItem("buildId"),k=sessionStorage.getItem("planId"),R=JSON.parse(c()(e.Form));0===R.isIdle&&(R.selectedUnitIdList=[]);for(var G=0;G<e.distributableList.length;G++)if(e.distributableList[G].houseId===R.houseId){var B=e.distributableList[G];R.houseNumber=B.houseNumber,R.houseUseArea=B.houseUseArea,R.housetypeName=B.housetypeName,R.originalUnitNameList=B.originalUnitNameList,R.rent=B.rent,B.isIdle=R.isIdle,B.selectedUnitIdList=R.selectedUnitIdList}for(var H=!0,P=0;P<e.editHouseInfo.length;P++)e.editHouseInfo[P].houseId===R.houseId&&(H=!1,e.editHouseInfo.splice(P,1,R));H&&e.editHouseInfo.push(R);for(var J=JSON.parse(c()(e.Form)),Z=0;Z<e.originalHouseList.length;Z++)if(e.originalHouseList[Z].houseId===J.houseId){var T=e.originalHouseList[Z];e.oldIdle=0===T.isIdle||1===T.isIdle?T.isIdle:null}0===J.isIdle&&(J.selectedUnitIdList=[]);var Y={};Y.buildId=F,Y.yardId=M,Y.planId=k,Y.houseId=J.houseId,Y.isIdle=J.isIdle,Y.configurePlanDataId=J.configurePlanDataId,Y.configurePlanOldUnits=[],Y.configurePlanNewUnits=[],Y.deleteCPNUnitIds=[],Y.deleteCPOUnitIds=[];var _=[];J.selectedUnitIdList.length>0&&(J.selectedUnitIdList=J.selectedUnitIdList.sort(function(e,t){return e-t})),J.newConfUnitList&&J.newConfUnitList.length>0&&(J.newConfUnitList.forEach(function(e){_.push(e.newUnitId)}),J.newConfUnitList.forEach(function(e){-1===J.selectedUnitIdList.indexOf(e.newUnitId)&&Y.deleteCPNUnitIds.push(e.configurePlanNewUnitId)})),J.selectedUnitIdList.length>0&&J.selectedUnitIdList.forEach(function(e){-1===_.indexOf(e)&&Y.configurePlanNewUnits.push({unitId:e})}),J.oldConfUnitList&&J.oldConfUnitList.length>0&&J.oldConfUnitList.forEach(function(e){Y.deleteCPOUnitIds.push(e.configurePlanOldUnitId)}),J.originalUnitList&&J.originalUnitList.length>0&&J.originalUnitList.forEach(function(e){Y.configurePlanOldUnits.push({unitId:e.originalUnitId})}),0===J.isIdle&&Y.configurePlanNewUnits.push({unitId:0}),0===J.isUse&&Y.configurePlanOldUnits.push({unitId:0});for(var z=0;z<e.saveFormList.length;z++)e.saveFormList[z].houseId===Y.houseId&&e.saveFormList.splice(z,1);if(Y.deleteCPNUnitIds.length>0||Y.configurePlanNewUnits.length>0||e.oldIdle!==Y.isIdle){if(e.revertSaveList.indexOf(Y.configurePlanDataId)>-1){var W=e.revertSaveList.indexOf(Y.configurePlanDataId);e.revertSaveList.splice(W,1)}e.saveFormList.push(Y)}for(var Q=e.canvas.getObjects("group"),V=function(s){var n=Q[s];"group"===n.type&&"room"===n.typeName&&n.uuid===t.houseId&&(0===n.getObjects("image").length&&U.Image.fromURL(i("5sxt"),function(t){var i=n.width,s=n.height,a=t.width,o=t.height;t.set({originX:"center",originY:"center",top:-s/2+o/2+1,left:i/2-a/2-1}),n.add(t),e.canvas.requestRenderAll()}))},X=0;X<Q.length;X++)V(X)}),this.getChangeData()),this.dialogVisible=!1},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;if(0===t.Form.isIdle&&(t.Form.selectedUnitIdList=[]),t.isBatchDistribute&&null!==t.Form.isIdle){if(1===t.Form.isIdle&&t.Form.selectedUnitIdList.length>0){for(var s=[],n=!1,a=t.Form.selectedUnitIdList.sort(function(e,t){return e-t}),o=JSON.parse(c()(t.selectedDistributeList)),r=function(e){var i=t.selectedDistributeList[e],r=[];i.originalUnitList.forEach(function(e){r.push(e.originalUnitId),r.sort(function(e,t){return e-t})}),c()(a)==c()(r)&&(n=!0,s.push(i.houseNumber),o.splice(e,1))},u=t.selectedDistributeList.length-1;u>=0;u--)r(u);if(n){var l=s.join("、");t.$confirm(l+"，原使用单位和分配单位完全相同，若点击确定按钮，房间号为"+l+"的房间将不进行分配，其余的房间正常分配。若点击取消，则重新选择分配单位。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){t.selectedDistributeList=o,t.batchDistributeDataSubmit()}).catch(function(){})}else t.batchDistributeDataSubmit()}else if(0===t.Form.isIdle){var d=[],h=!1,g=JSON.parse(c()(t.selectedDistributeList));for(u=t.selectedDistributeList.length-1;u>=0;u--){var b=t.selectedDistributeList[u];0!==b.isUse||b.rent||(h=!0,d.unshift(b.houseNumber),g.splice(u,1))}if(h){var v=d.join("、");t.$confirm(v+"没有原使用单位，若点击确定按钮，该房间的使用状态不会改变，其余的房间变为不使用。若点击取消，则重新选择。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){t.selectedDistributeList=g,t.batchDistributeDataSubmit()}).catch(function(){})}else t.batchDistributeDataSubmit()}}else if(!t.isBatchDistribute&&null!==t.Form.isIdle){if(1===t.Form.isIdle){var f=t.Form.selectedUnitIdList.sort(function(e,t){return e-t}),m=[];if(t.Form.originalUnitList.forEach(function(e){m.push(e.originalUnitId),m.sort(function(e,t){return e-t})}),c()(f)==c()(m))return void t.$message({message:"分配单位不能和原使用单位完全相同！",type:"warning"})}for(var I=null,p=null,L=JSON.parse(c()(t.Form)),A=L.isIdle,C=0;C<t.originalHouseList.length;C++)if(L.houseId===t.originalHouseList[C].houseId){I=t.originalHouseList[C].newConfUnitList,p=t.originalHouseList[C].isIdle;break}if(void 0===t.distributeChangeObj[L.houseId]&&(t.distributeChangeObj[L.houseId]={},t.distributeChangeObj[L.houseId].remove=[],t.distributeChangeObj[L.houseId].add=[]),0!==p&&1!==p){if(0===A){if(L.rent){var N={unitNames:"出租"};N.useArea="-"+L.houseUseArea-0,N.houseNumber=-1,t.distributeChangeObj[L.houseId].remove=[],t.distributeChangeObj[L.houseId].remove.push(N)}else{var O=[];L.originalUnitList.forEach(function(e){O.push(e.originalUnitName)});var j={};j.unitNames=O.join(","),j.useArea="-"+L.houseUseArea-0,j.houseNumber=-1,t.distributeChangeObj[L.houseId].remove=[],t.distributeChangeObj[L.houseId].remove.push(j)}var w={unitNames:"闲置"};w.useArea=""+L.houseUseArea-0,w.houseNumber=1,t.distributeChangeObj[L.houseId].add=[],t.distributeChangeObj[L.houseId].add.push(w)}else if(1===A){if(L.rent){var D={unitNames:"出租"};D.useArea="-"+L.houseUseArea-0,D.houseNumber=-1,t.distributeChangeObj[L.houseId].remove=[],t.distributeChangeObj[L.houseId].remove.push(D)}else if(L.originalUnitList.length>0){var S=[];L.originalUnitList.forEach(function(e){S.push(e.originalUnitName)});var y={};y.unitNames=S.join(","),y.useArea="-"+L.houseUseArea-0,y.houseNumber=-1,t.distributeChangeObj[L.houseId].remove=[],t.distributeChangeObj[L.houseId].remove.push(y)}else{var E={unitNames:"闲置"};E.useArea="-"+L.houseUseArea-0,E.houseNumber=-1,t.distributeChangeObj[L.houseId].remove=[],t.distributeChangeObj[L.houseId].remove.push(E)}var x=[],M=L.selectedUnitIdList;(M=M.sort(function(e,t){return e-t})).forEach(function(e){for(var i=0;i<t.unitOptions.length;i++)if(e===t.unitOptions[i].unitId){x.push(t.unitOptions[i].unitName);break}});var F={};F.unitNames=x.join(","),F.useArea=""+L.houseUseArea-0,F.houseNumber=1,t.distributeChangeObj[L.houseId].add=[],t.distributeChangeObj[L.houseId].add.push(F)}}else if(0===p){if(1===A){var k={unitNames:"闲置"};k.useArea="-"+L.houseUseArea-0,k.houseNumber=-1,t.distributeChangeObj[L.houseId].remove=[],t.distributeChangeObj[L.houseId].remove.push(k);var R=[],G=L.selectedUnitIdList;(G=G.sort(function(e,t){return e-t})).forEach(function(e){for(var i=0;i<t.unitOptions.length;i++)if(e===t.unitOptions[i].unitId){R.push(t.unitOptions[i].unitName);break}});var B={};B.unitNames=R.join(","),B.useArea=""+L.houseUseArea-0,B.houseNumber=1,t.distributeChangeObj[L.houseId].add=[],t.distributeChangeObj[L.houseId].add.push(B)}}else if(1===p)if(0===A){var H=[];I.length>0&&I.forEach(function(e){H.push(e.newUnitName)});var P={};P.unitNames=H.join(","),P.useArea="-"+L.houseUseArea-0,P.houseNumber=-1,t.distributeChangeObj[L.houseId].remove=[],t.distributeChangeObj[L.houseId].remove.push(P);var J={unitNames:"闲置"};J.useArea=""+L.houseUseArea-0,J.houseNumber=1,t.distributeChangeObj[L.houseId].add=[],t.distributeChangeObj[L.houseId].add.push(J)}else if(1===A){var Z=[];I.length>0&&I.forEach(function(e){Z.push(e.newUnitName)});var T={};T.unitNames=Z.join(","),T.useArea="-"+L.houseUseArea-0,T.houseNumber=-1,t.distributeChangeObj[L.houseId].remove=[],t.distributeChangeObj[L.houseId].remove.push(T);var Y=[],_=t.Form.selectedUnitIdList;(_=_.sort(function(e,t){return e-t})).forEach(function(e){for(var i=0;i<t.unitOptions.length;i++)if(e===t.unitOptions[i].unitId){Y.push(t.unitOptions[i].unitName);break}});var z={};z.unitNames=Y.join(","),z.useArea=""+L.houseUseArea-0,z.houseNumber=1,t.distributeChangeObj[L.houseId].add=[],t.distributeChangeObj[L.houseId].add.push(z)}t.getChangeData();var W=t.canvas.getActiveObject();0===W.getObjects("image").length&&U.Image.fromURL(i("5sxt"),function(e){var i=W.width,s=W.height,n=e.width,a=e.height;e.set({originX:"center",originY:"center",top:-s/2+a/2+1,left:i/2-n/2-1}),W.add(e),t.canvas.requestRenderAll()});var Q=sessionStorage.getItem("yardId"),V=sessionStorage.getItem("buildId"),X=sessionStorage.getItem("planId"),$=JSON.parse(c()(t.Form));0===$.isIdle&&($.selectedUnitIdList=[]);for(var K=0;K<t.editHouseInfo.length;K++)t.editHouseInfo[K].houseId===$.houseId&&t.editHouseInfo.splice(K,1);t.editHouseInfo.push($);for(var q=0;q<t.distributableList.length;q++)t.distributableList[q].houseId===$.houseId&&t.distributableList.splice(q,1);t.distributableList.push($);var ee=JSON.parse(c()(t.Form));0===ee.isIdle&&(ee.selectedUnitIdList=[]);var te={};te.buildId=V,te.yardId=Q,te.planId=X,te.houseId=ee.houseId,te.isIdle=ee.isIdle,te.configurePlanDataId=ee.configurePlanDataId||null,te.configurePlanOldUnits=[],te.configurePlanNewUnits=[],te.deleteCPNUnitIds=[],te.deleteCPOUnitIds=[];var ie=[];ee.selectedUnitIdList.length>0&&(ee.selectedUnitIdList=ee.selectedUnitIdList.sort(function(e,t){return e-t})),ee.newConfUnitList&&ee.newConfUnitList.length>0&&(ee.newConfUnitList.forEach(function(e){ie.push(e.newUnitId)}),ee.newConfUnitList.forEach(function(e){-1===ee.selectedUnitIdList.indexOf(e.newUnitId)&&te.deleteCPNUnitIds.push(e.configurePlanNewUnitId)})),ee.selectedUnitIdList.length>0&&ee.selectedUnitIdList.forEach(function(e){-1===ie.indexOf(e)&&te.configurePlanNewUnits.push({unitId:e})}),ee.oldConfUnitList&&ee.oldConfUnitList.length>0&&ee.oldConfUnitList.forEach(function(e){te.deleteCPOUnitIds.push(e.configurePlanOldUnitId)}),ee.originalUnitList&&ee.originalUnitList.length>0&&ee.originalUnitList.forEach(function(e){te.configurePlanOldUnits.push({unitId:e.originalUnitId})}),0===ee.isIdle&&te.configurePlanNewUnits.push({unitId:0}),0===ee.isUse&&te.configurePlanOldUnits.push({unitId:0});for(var se=0;se<t.saveFormList.length;se++)t.saveFormList[se].houseId===te.houseId&&t.saveFormList.splice(se,1);if(te.deleteCPNUnitIds.length>0||te.configurePlanNewUnits.length>0||t.oldIdle!==te.isIdle){if(t.revertSaveList.indexOf(te.configurePlanDataId)>-1){var ne=t.revertSaveList.indexOf(te.configurePlanDataId);t.revertSaveList.splice(ne,1)}t.saveFormList.push(te)}t.dialogVisible=!1}})},allSave:function(){var e=this,t=sessionStorage.getItem("buildId"),i=sessionStorage.getItem("floorName"),s=sessionStorage.getItem("configureId"),n=sessionStorage.getItem("planId");if(!t||!i)return this.$message({message:"请先选择楼层",type:"warning"}),!1;var a={};a.configureId=s,a.planId=n,a.configurePlanDataList=this.saveFormList,a.configurePlanChangeDataList=this.distributeChangeList,this.revertSaveList.length>0&&(a.deleteCPDIds=this.revertSaveList),Object(v.v)(a).then(function(t){e.$message({message:"保存成功",type:"success"}),e.saveFormList=[],e.editHouseInfo=[],e.revertSaveList=[],e.originalHouseList=[],e.distributableList=[],e.distributableIdList=[],e.selectedDistributeList=[],e.distributeChangeList=[],e.distributeChangeObj={};var i=sessionStorage.getItem("buildId")-0,s=sessionStorage.getItem("floorName")-0;e.getallocationFloorInfo(i,s),e.getOldChangeData()}).catch(function(t){var i=t.result?t.result:"保存失败";e.$message({message:i,type:"error"}),e.saveFormList=[],e.editHouseInfo=[],e.revertSaveList=[],e.originalHouseList=[],e.distributableList=[],e.distributableIdList=[],e.selectedDistributeList=[],e.distributeChangeList=[],e.distributeChangeObj={}})},removeIcon:function(){var e=this;this.canvas.getObjects("group").forEach(function(t){if("room"===t.typeName){var i=t.getObjects("image");i.length>0&&i.forEach(function(i){"overproof"!==i.typeName&&"isRecord"!==i.typeName||(t.remove(i),e.canvas.renderAll())})}});var t=sessionStorage.getItem("buildId"),i=sessionStorage.getItem("floorName");this.getallocationFloorInfo(t,i)},getHouseGraphJson:function(e,t){var i=this;Object(v.o)(e,t).then(function(e){i.canvas.loadFromJSON(e,i.removeIcon),i.showChangeDetail||(i.showChangeDetail=!0)}).catch(function(e){var t=e.result?e.result:"暂无楼层图形";i.$message({message:t,type:"warning"}),i.canvas.clear()})},getallocationFloorInfo:function(e,t){var s=this;this.originalHouseList=[],this.distributableList=[],this.distributableIdList=[],this.selectedDistributeList=[];var n=sessionStorage.getItem("planId");Object(v.t)(e,t,n).then(function(e){e.forEach(function(e){var t={configurePlanDataId:null,houseId:null,houseNumber:null,originalUnitNameList:"",newUnitNameList:"",houseUseArea:"",housetypeName:"",isIdle:null,originalUnitList:[],oldConfUnitList:[],newConfUnitList:[],selectedUnitIdList:[],isUse:null,applyStatus:null,handleWay:null,isIdleText:"",rent:""},i=!0,n=!1,a=void 0;try{for(var r,l=d()(u()(e.allocationUnit));!(i=(r=l.next()).done);i=!0){var h=r.value,g=o()(h,2),b=g[0],v=g[1];void 0!==t[b]&&(t[b]=v)}}catch(e){n=!0,a=e}finally{try{!i&&l.return&&l.return()}finally{if(n)throw a}}if(e.allocationConf){var f=!0,m=!1,I=void 0;try{for(var p,L=d()(u()(e.allocationConf));!(f=(p=L.next()).done);f=!0){var A=p.value,U=o()(A,2);b=U[0],v=U[1];void 0!==t[b]&&(t[b]=v)}}catch(e){m=!0,I=e}finally{try{!f&&L.return&&L.return()}finally{if(m)throw I}}}t.newConfUnitList=e.newConfUnitList,t.oldConfUnitList=e.oldConfUnitList,t.isIdleText=0===t.isIdle||1===t.isIdle?"已调整":"未调整";var C=[],N=[];t.rent?t.originalUnitNameList="出租":t.originalUnitList&&t.originalUnitList.length>0?(t.originalUnitList.forEach(function(e){C.push(e.originalUnitName)}),t.originalUnitNameList=C.join(",")):t.originalUnitNameList="暂无",t.configurePlanDataId&&t.newConfUnitList.length>0?(t.newConfUnitList.forEach(function(e){t.selectedUnitIdList.push(e.newUnitId),N.push(e.newUnitName)}),t.newUnitNameList=C.join(",")):t.newUnitNameList="暂无",s.originalHouseList.push(t);var O=JSON.parse(c()(t));s.distributableList.push(O),s.distributableIdList.push(O.houseId)});for(var t=s.canvas.getObjects("group"),n=0;n<s.originalHouseList.length;n++)if(1===s.originalHouseList[n].isIdle||0===s.originalHouseList[n].isIdle)for(var a=function(e){var a=t[e];if("room"===a.typeName&&a.uuid===s.originalHouseList[n].houseId)return U.Image.fromURL(i("5sxt"),function(e){var t=a.width,i=a.height,n=e.width,o=e.height;e.set({originX:"center",originY:"center",top:-i/2+o/2+1,left:t/2-n/2-1}),a.add(e),s.canvas.requestRenderAll()}),"break"},r=0;r<t.length;r++){if("break"===a(r))break}}).catch(function(e){var t=e.result?e.result:"楼层房间数据获取失败";s.$message({message:t,type:"warning"})})},getChangeData:function(){var e={},t=[],i=[];for(var s in this.distributeChangeList=JSON.parse(c()(this.oldDistributeChangeList)),this.distributeChangeObj)t.push.apply(t,this.distributeChangeObj[s].add),t.push.apply(t,this.distributeChangeObj[s].remove);if(t.length>0)for(var n in t.forEach(function(t){void 0!==e[t.unitNames]?e[t.unitNames].push(t):(e[t.unitNames]=[],e[t.unitNames].push(t))}),e){var a={},o=0,r=0,u=!0;if(a.unitNames=n,e[n].forEach(function(e){o+=e.useArea,r+=e.houseNumber}),a.useArea=o,a.houseNumber=r,this.distributeChangeList.length>0)for(var l=this.distributeChangeList.length-1;l>=0;l--)a.unitNames===this.distributeChangeList[l].unitNames&&(u=!1,this.distributeChangeList[l].useArea=a.useArea+this.distributeChangeList[l].useArea,this.distributeChangeList[l].houseNumber=a.houseNumber+this.distributeChangeList[l].houseNumber,0===this.distributeChangeList[l].useArea&&0===this.distributeChangeList[l].houseNumber&&this.distributeChangeList.splice(l,1));u&&i.push(a)}this.distributeChangeList.push.apply(this.distributeChangeList,i),this.distributeChangeList.forEach(function(e){e.useArea=e.useArea.toFixed(2)})},dialogOpen:function(){var e=this;this.$nextTick(function(){e.$refs.Form&&e.$refs.Form.clearValidate()})},dialogClosed:function(){this.clearForm(this.Form),this.currentUseState=!1,this.oldIdle=null,this.distributeFlag=!1,this.isBatchDistribute=!1,this.selectedDistributeList=[]},getDataType:function(e){var t=!0,i=!1,s=void 0;try{for(var n,a=d()(["String","Object","Number","Array","Date"]);!(t=(n=a.next()).done);t=!0){var o=n.value;if(Object.prototype.toString.call(e)==="[object "+o+"]")return o}}catch(e){i=!0,s=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw s}}},clearForm:function(e){for(var t in e){var i=this.getDataType(e[t]);if("String"===i)e[t]="";else if("Array"===i)e[t]=[];else if("Object"===i){n()(e[t]).length>0?this.clearForm(e[t]):e[t]={}}else e[t]=null}},limitFloat:function(e,t){this.Form[e]=this.Form[e].replace(/[^\d.]/g,"").replace(/\.{2,}/g,".").replace(".","$#$").replace(/\./g,"").replace("$#$",".").replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3").replace(/^\./g,""),t&&""!==this.Form[e]&&(this.Form[e]=(this.Form[e]-0).toFixed(2))},handleSelectionChange:function(e){this.selectedDistributeList=e},getOldChangeData:function(){var e=this,t=sessionStorage.getItem("planId")-0;Object(v.i)(t).then(function(t){t&&(e.oldDistributeChangeList=t,e.distributeChangeList=t)}).catch(function(t){var i=t.result?t.result:"分配统计数据获取失败";e.$message({message:i,type:"error"})})},getRouterList:function(){var e=this;Object(b.i)().then(function(t){e.allNavList=t}).catch(function(t){var i=t.result?t.result:"路由信息获取失败！";e.$message({message:i,type:"error"})})}},mounted:function(){var e=this;this.$nextTick(function(){e.init()}),f.a.$off("getGraphJson"),f.a.$off("clearCanvas"),f.a.$off("showDistributeTips"),f.a.$off("collapse"),f.a.$on("getGraphJson",function(t){e.getHouseGraphJson(t.buildId,t.floorName),!1===t.canDistributeOrSave?e.canDistributeOrSave=!1:e.canDistributeOrSave=!0,t.notDistributeReason&&(e.notDistributeReason=t.notDistributeReason)}),f.a.$on("clearCanvas",function(){e.canvas&&e.canvas.clear&&e.canvas.clear(),sessionStorage.removeItem("yardId"),sessionStorage.removeItem("buildId"),sessionStorage.removeItem("floorName")}),f.a.$on("showDistributeTips",function(t,i){if(e.revertSaveList.length>0||e.saveFormList.length>0)e.$confirm("当前楼层数据还未保存，可点击右下角保存按钮保存，如若切换楼层将清空刚才所编辑的数据，是否继续此操作？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){if(sessionStorage.removeItem("yardId"),sessionStorage.removeItem("buildId"),sessionStorage.removeItem("floorName"),t&&e.$router.push(t),i){e.menuKey=e.$route.params.id;for(var s=0;s<e.allNavList.length;s++)e.allNavList[s].key===e.menuKey&&(e.navlist=e.allNavList[s].children,e.$store.commit("changeNavList",e.navlist))}}).catch(function(){e.$message({type:"info",message:"已取消切换"})});else if(sessionStorage.removeItem("yardId"),sessionStorage.removeItem("buildId"),sessionStorage.removeItem("floorName"),t&&e.$router.push(t),i){e.menuKey=e.$route.params.id;for(var s=0;s<e.allNavList.length;s++)e.allNavList[s].key===e.menuKey&&(e.navlist=e.allNavList[s].children,e.$store.commit("changeNavList",e.navlist))}}),f.a.$on("collapse",function(){setTimeout(function(){e.setZoom()},1e3)}),Object(b.l)().then(function(t){e.unitOptions=t}).catch(function(t){var i=t.result?t.result:"单位下拉选项获取失败";e.$message({message:i,type:"error"})}),this.getOldChangeData(),this.getRouterList()}}),N={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"roomDistributeView"}},[s("div",{staticClass:"plane"},[s("div",{staticClass:"canvasDiv",on:{contextmenu:function(t){t.preventDefault(),e.showContextMenu(t)}}},[s("canvas",{attrs:{id:"c"}},[e._v("请使用支持HTML5的浏览器")])])]),e._v(" "),s("div",{staticClass:"btn-box"},[e.canDistributeOrSave?s("button",{staticClass:"graph-btn batch-distribute-btn",on:{click:e.batchDistribution}},[e._v("批量分配")]):e._e(),e._v(" "),e.canDistributeOrSave?s("button",{staticClass:"graph-btn batch-revert-btn",on:{click:e.batchRevert}},[e._v("批量撤销")]):e._e(),e._v(" "),s("button",{staticClass:"graph-btn",on:{click:e.allSave}},[e._v("保存")])]),e._v(" "),s("el-dialog",{attrs:{visible:e.dialogVisible,"close-on-click-modal":!1,width:"1100px",center:!0},on:{"update:visible":function(t){e.dialogVisible=t},open:e.dialogOpen,closed:e.dialogClosed}},[s("div",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[s("span",[e._v("房间信息")])]),e._v(" "),s("div",{staticClass:"dialog-content"},[s("div",{staticClass:"base-info-box"},[s("div",{staticClass:"base-info-title"},[s("span",{staticClass:"base-info-icon"}),e._v(" "),s("span",[e._v("基本信息")])]),e._v(" "),e.isBatchDistribute?e._e():s("div",{staticClass:"base-info-content"},[s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:6}},[s("div",{staticClass:"grid-content"},[s("span",{staticClass:"grid-content-title"},[e._v("使用单位：")]),e._v(" "),s("span",[e._v(e._s(e.Form.originalUnitNameList?e.Form.originalUnitNameList:"暂无"))])])]),e._v(" "),s("el-col",{attrs:{span:6}},[s("div",{staticClass:"grid-content"},[s("span",{staticClass:"grid-content-title"},[e._v("房间号：")]),e._v(" "),s("span",[e._v(e._s(e.Form.houseNumber))])])]),e._v(" "),s("el-col",{attrs:{span:6}},[s("div",{staticClass:"grid-content"},[s("span",{staticClass:"grid-content-title"},[e._v("使用面积：")]),e._v(" "),s("span",[e._v(e._s(e.Form.houseUseArea)+"m²")])])]),e._v(" "),s("el-col",{attrs:{span:6}},[s("div",{staticClass:"grid-content"},[s("span",{staticClass:"grid-content-title"},[e._v("房间类型：")]),e._v(" "),s("span",[e._v(e._s(e.Form.housetypeName))])])])],1)],1),e._v(" "),e.isBatchDistribute?s("div",{staticClass:"base-info-content"},[s("el-row",[s("el-col",{attrs:{span:24}},[s("div",{staticClass:"grid-content batch"},[s("span",[e._v("选择分配的房间：")]),e._v(" "),s("div",{staticClass:"room-table"},[s("table-component",{attrs:{tableData:e.selectedDistributeList,tableHeight:200,tableCellPadding:"0"},on:{select:e.handleSelectionChange}},[s("el-table-column",{attrs:{prop:"houseNumber",label:"房间号","show-overflow-tooltip":!0}}),e._v(" "),s("el-table-column",{attrs:{prop:"originalUnitNameList",label:"使用单位","show-overflow-tooltip":!0}}),e._v(" "),s("el-table-column",{attrs:{prop:"houseUseArea",label:"使用面积(m²)","show-overflow-tooltip":!0}}),e._v(" "),s("el-table-column",{attrs:{prop:"housetypeName",label:"房间类型","show-overflow-tooltip":!0}}),e._v(" "),s("el-table-column",{attrs:{prop:"isIdleText",label:"是否调整","show-overflow-tooltip":!0}}),e._v(" "),s("el-table-column",{attrs:{prop:"newUnitNameList",label:"已分配单位","show-overflow-tooltip":!0}})],1)],1)])])],1),e._v(" "),s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:12}},[s("div",{staticClass:"grid-content batch"},[s("span",[e._v("可分配的房间总面积：")]),e._v(" "),s("span",[e._v(e._s(this.totalRoomArea)+"m²")])])]),e._v(" "),s("el-col",{attrs:{span:12}},[s("div",{staticClass:"grid-content batch"},[s("span",[e._v("可分配的房间总数量：")]),e._v(" "),s("span",[e._v(e._s(this.totalRoomNum))])])])],1)],1):e._e()]),e._v(" "),s("div",{staticClass:"distribute-unit-box"},[s("div",{staticClass:"distribute-unit-title"},[s("span",{staticClass:"edit-info-icon"}),e._v(" "),s("span",[e._v("使用情况")]),e._v(" "),e.currentUseState||e.distributeFlag?e._e():s("span",{staticClass:"distribute-btn",on:{click:e.distributeStart}},[s("span",{staticClass:"iconfont"},[e._v("")]),e._v("调整\n          ")]),e._v(" "),!e.currentUseState&&e.distributeFlag?s("span",{staticClass:"distribute-btn",on:{click:e.distributeEnd}},[s("span",{staticClass:"iconfont"},[e._v("")]),e._v("取消调整\n          ")]):e._e()]),e._v(" "),null!==e.Form.isIdle?s("div",{staticClass:"distribute-unit-content"},[s("el-form",{ref:"Form",attrs:{model:e.Form,rules:e.rules,"label-width":"78px"}},[s("el-form-item",{attrs:{label:"使用情况",prop:"isIdle"}},[s("el-radio-group",{on:{change:e.idleRadioChange},model:{value:e.Form.isIdle,callback:function(t){e.$set(e.Form,"isIdle",t)},expression:"Form.isIdle"}},[s("el-radio",{attrs:{label:1}},[e._v("占用")]),e._v(" "),s("el-radio",{attrs:{label:0}},[e._v("闲置")])],1)],1),e._v(" "),1===e.Form.isIdle?s("el-form-item",{staticClass:"unit-select-form-item",attrs:{label:"占用单位",prop:"selectedUnitIdList"}},[s("el-select",{attrs:{multiple:"",placeholder:"请选择单位"},model:{value:e.Form.selectedUnitIdList,callback:function(t){e.$set(e.Form,"selectedUnitIdList",t)},expression:"Form.selectedUnitIdList"}},e._l(e.unitOptions,function(e){return s("el-option",{key:e.unitId,attrs:{label:e.unitName,value:e.unitId}})}))],1):e._e()],1)],1):e._e()])]),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("cancel-btn",{attrs:{fontSize:14},on:{clickBtn:function(t){e.dialogVisible=!1}}}),e._v(" "),s("confirm-btn",{attrs:{fontSize:14},on:{clickBtn:function(t){e.submitForm("Form")}}})],1)]),e._v(" "),s("div",{staticClass:"house-type-box"},[s("ul",[e._m(0),e._v(" "),e._m(1),e._v(" "),e._m(2),e._v(" "),e._m(3),e._v(" "),e._m(4),e._v(" "),e._m(5),e._v(" "),"gl"!==e.PRO_TYPE?s("li",[s("span",{staticStyle:{background:"#fe8200"}}),e._v("\n        租借用房\n      ")]):e._e()])]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.showChangeDetail,expression:"showChangeDetail"}],staticClass:"change-detail-dialog"},[s("div",{directives:[{name:"show",rawName:"v-show",value:!e.expandChangeDetail,expression:"!expandChangeDetail"}],staticClass:"top-arrow-btn",on:{click:e.changeBoxExpand}},[s("img",{attrs:{src:i("evhW"),alt:"展开按钮"}})]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.expandChangeDetail,expression:"expandChangeDetail"}],staticClass:"down-arrow-btn",on:{click:e.changeBoxCollapse}},[s("img",{attrs:{src:i("clv2"),alt:"收缩按钮"}})]),e._v(" "),s("div",{staticClass:"change-detail-title"},[e._v("分配统计")]),e._v(" "),s("div",{staticClass:"change-detail-content"},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.distributeChangeList,"header-cell-style":e.tableHeaderCellStyle,"cell-style":e.tableCellStyle,height:e.tableHeight}},[s("el-table-column",{attrs:{prop:"unitNames",label:"单位名称","header-align":"center",align:"center","show-overflow-tooltip":!0}}),e._v(" "),s("el-table-column",{attrs:{prop:"houseNumber",label:"房间数量","header-align":"center",align:"center","show-overflow-tooltip":!0}}),e._v(" "),s("el-table-column",{attrs:{prop:"useArea",label:"面积(m²)","header-align":"center",align:"center","show-overflow-tooltip":!0}})],1)],1)])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("li",[t("span",{staticStyle:{background:"#cccccc"}}),this._v("\n        未填写信息\n      ")])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[t("span",{staticStyle:{background:"#21b124"}}),this._v("\n        办公室用房\n      ")])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[t("span",{staticStyle:{background:"#f4e83b"}}),this._v("\n        服务用房\n      ")])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[t("span",{staticStyle:{background:"#008aff"}}),this._v("\n        设备用房\n      ")])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[t("span",{staticStyle:{background:"#12fff1"}}),this._v("\n        附属用房\n      ")])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[t("span",{staticStyle:{background:"#ff01fd"}}),this._v("\n        业务用房\n      ")])}]};var O=i("VU/8")(C,N,!1,function(e){i("IQiS")},null,null);t.default=O.exports},evhW:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFwAAAASCAYAAADWvblEAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo3MUI3QjAxNjM1QUYxMUU5OUQ4NEI3OTQ1MjdCQzQ2QSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo3MUI3QjAxNzM1QUYxMUU5OUQ4NEI3OTQ1MjdCQzQ2QSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjcxQjdCMDE0MzVBRjExRTk5RDg0Qjc5NDUyN0JDNDZBIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjcxQjdCMDE1MzVBRjExRTk5RDg0Qjc5NDUyN0JDNDZBIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+BENG0wAAAadJREFUeNpiZPCvYiASGAJxNxA7M4wCZLAXiEv/b2g9T4xiJiINzQDi46OBjRWAwuQ4Y0B1BrUCvAaIpwMx+2jY4gSgsJkODPQaSgM8E4ibR8OTaNAMDPRMcgPcBognj4YhyWAyMNBtSA1wQSBeDsTMg9VXfmaag9VpoDBbDgx0QVICvA+IZQarj7bXxTMsKghh2FgVO1idKAMNQ6IC3AqI4werT0CBbKEux3D69lMGO22FwRzo8cBUbkUowBmhMcM4WAMbFMjrT1xjcK2fx7Dj3K3BHOjgsAQGOiO+AA8DYvPBHNigQE6avBYsFtm7crAHujk0TLEGOKiwbxmMrl5REgEPbFAgIwPkQF9eHD4Ynd8CTOXM2AI8BIhVBptrQYHobqiKNbDRA93DSG0wBroKNGxRAhxUzlQMNpcaKkkxeBqr4Q1s5EDfe/EOWD1I3yADFbCynBE6eOUEHYRhGIyBfv7eM5qpp+eYy/8NrftgKTxrsLatSA28QRrY8DAGpXBQ/nsIxCyjvXKagj9ALA9K4dGjgU0XAArjaFCAx4yGBd1ADECAAQC7eXg7qjtHOwAAAABJRU5ErkJggg=="}});
//# sourceMappingURL=16.afe1c52cf68073249b13.js.map